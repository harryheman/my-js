---
sidebar_position: 17
title: –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤–µ–±-–ø–æ—Ç–æ–∫–æ–≤ –≤ Node.js
description: –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤–µ–±-–ø–æ—Ç–æ–∫–æ–≤ –≤ Node.js
keywords: ["node.js", nodejs, web-streams, stream, –≤–µ–±-–ø–æ—Ç–æ–∫–∏, –ø–æ—Ç–æ–∫]
tags: ["node.js", nodejs, web-streams, stream, –≤–µ–±-–ø–æ—Ç–æ–∫–∏, –ø–æ—Ç–æ–∫]
---

# Web Streams

[–ò—Å—Ç–æ—á–Ω–∏–∫](https://2ality.com/2022/06/web-streams-nodejs.html)&nbsp;&nbsp;üëÄ

–í–µ–±-–ø–æ—Ç–æ–∫–∏ (web streams) - —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤ (streams), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤—Å–µ–º–∏ –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –≤–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏: –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä–∞–º–∏, [Node.js](https://nodejs.org/) –∏ [Deno](https://deno.land/). –ü–æ—Ç–æ–∫–∏ - —ç—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –Ω–µ–±–æ–ª—å—à–∏–º–∏ —á–∞—Å—Ç—è–º–∏ –∏–∑ –ª—é–±–æ–≥–æ –≤–∏–¥–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ - —Ñ–∞–π–ª–æ–≤, –¥–∞–Ω–Ω—ã—Ö, –Ω–∞—Ö–æ–¥—è—â–∏—Ö—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –∏ —Ç.–¥.

–ù–∞–ø—Ä–∏–º–µ—Ä, –≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è [fetch](https://developer.mozilla.org/ru/docs/Web/API/Fetch_API/Using_Fetch) (–∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–Ω–ª–∞–π–Ω-—Ä–µ—Å—É—Ä—Å–æ–≤) –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç (`Response`), —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Å–≤–æ–π—Å—Ç–≤–æ `body` —Å –≤–µ–±-–ø–æ—Ç–æ–∫–æ–º.

## 1. –ß—Ç–æ —Ç–∞–∫–æ–µ –≤–µ–±-–ø–æ—Ç–æ–∫?

–ü–æ—Ç–æ–∫ - —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (data structure) –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–∫–∏–º –¥–∞–Ω–Ω—ã–º, –∫–∞–∫:

- —Ñ–∞–π–ª—ã;
- –¥–∞–Ω–Ω—ã–µ, –Ω–∞—Ö–æ–¥—è—â–∏–µ—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ;
- –∏ —Ç.–¥.

–î–≤—É–º—è –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞–º–∏ –ø–æ—Ç–æ–∫–æ–≤ —è–≤–ª—è—é—Ç—Å—è:

- –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥–∞–Ω–Ω—ã—Ö –±–ª–∞–≥–æ–¥–∞—Ä—è —Ç–æ–º—É, —á—Ç–æ –ø–æ—Ç–æ–∫–∏ —Ä–∞–∑–¥–µ–ª—è—é—Ç –∏—Ö –Ω–∞ –Ω–µ–±–æ–ª—å—à–∏–µ —á–∞—Å—Ç–∏ (–Ω–∞–∑—ã–≤–∞–µ–º—ã–µ "—á–∞–Ω–∫–∞–º–∏"/chunks), –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –ø–æ –æ–¥–Ω–æ–º—É –∑–∞ —Ä–∞–∑;
- –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–¥–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞–∑–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –æ–±–ª–µ–≥—á–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞.

–í–µ–±-–ø–æ—Ç–æ–∫–∏ ("–≤–µ–±" —á–∞—Å—Ç–æ –æ–ø—É—Å–∫–∞–µ—Ç—Å—è) - —ç—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–æ–≤—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç, –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –±—Ä–∞—É–∑–µ—Ä–∞–º–∏, –Ω–æ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∞–∫–∂–µ `Node.js` –∏ `Deno`, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ [—ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü–µ](https://developer.mozilla.org/en-US/docs/Web/API/Streams_API#browser_compatibility).

–ß–∞–Ω–∫–∏ –±—ã–≤–∞—é—Ç 2 –≤–∏–¥–æ–≤:

- —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ—Ç–æ–∫–∏ (text streams): —Å—Ç—Ä–æ–∫–∏;
- –±–∏–Ω–∞—Ä–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ (–ø–æ—Ç–æ–∫–∏ –±–∞–π—Ç–æ–≤) (binary streams): [Uint8Array](https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array) (—Ä–∞–∑–Ω–æ–≤–∏–¥–Ω–æ—Å—Ç—å [TypedArray](https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/TypedArray) (—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤)).

### 1.1. –í–∏–¥—ã –ø–æ—Ç–æ–∫–æ–≤

–°—É—â–µ—Å—Ç–≤—É–µ—Ç 3 –æ—Å–Ω–æ–≤–Ω—ã—Ö –≤–∏–¥–∞ –ø–æ—Ç–æ–∫–æ–≤:

- `RS` (–ø–æ—Ç–æ–∫ –¥–ª—è —á—Ç–µ–Ω–∏—è) (–¥–∞–ª–µ–µ - `RS`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (source). –ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —ç—Ç–æ –¥–µ–ª–∞–µ—Ç, –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–º (consumer);
- `WS` (–ø–æ—Ç–æ–∫ –¥–ª—è –∑–∞–ø–∏—Å–∏) (–¥–∞–ª–µ–µ - `WS`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–∏–µ–º–Ω–∏–∫ (sink). –ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —ç—Ç–æ –¥–µ–ª–∞–µ—Ç, –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–º (producer);
- `TS` (–ø–æ—Ç–æ–∫ –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è) (–¥–∞–ª–µ–µ - `TS`) —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 2 –ø–æ—Ç–æ–∫–æ–≤:
  - –æ–Ω –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—é—â–µ–π —Å—Ç–æ—Ä–æ–Ω—ã (—Å—Ç–æ—Ä–æ–Ω—ã –¥–ª—è –∑–∞–ø–∏—Å–∏) (writable side), `WS`;
  - –æ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—â–µ–π —Å—Ç–æ—Ä–æ–Ω–µ (—Å—Ç–æ—Ä–æ–Ω–µ –¥–ª—è —á—Ç–µ–Ω–∏—è) (readable side), `RS`.

–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è `TS` —Å–æ—Å—Ç–æ–∏—Ç –≤ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–æ—Ö–æ–¥—è—â–∏—Ö —á–µ—Ä–µ–∑ —Ç—É–Ω–Ω–µ–ª—å (–∫–æ–Ω–≤–µ–π–µ—Ä) (pipe). –î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ –∏ –ø–æ—Å–ª–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —á–∏—Ç–∞—é—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –¥–ª—è —á—Ç–µ–Ω–∏—è. –°–ª–µ–¥—É—é—â–∏–µ `TS` –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏—Ö `JavaScript`:

- –ø–æ—Å–∫–æ–ª—å–∫—É —Å—Ç—Ä–æ–∫–∏ –≤ `JS` –∏–º–µ—é—Ç –∫–æ–¥–∏—Ä–æ–≤–∫—É `UTF-16`, –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ `UTF-8` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –¥–≤–æ–∏—á–Ω—ã–µ. `TextDecoderStream` –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫–∏;
- `TextEncoderStream` –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫–∏ –≤ –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ `UTF-8`;
- `CompressionStream` —Å–∂–∏–º–∞–µ—Ç –¥–≤–æ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ `GZIP` –∏ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã —Å–∂–∞—Ç–∏—è;
- `DecompressionStream` –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `GZIP` –∏ –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤.

`RS`, `WS` –∏ `TS` –º–æ–≥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∏–ª–∏ –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –í —Å—Ç–∞—Ç—å–µ –º—ã –±—É–¥–µ–º –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –≥–æ–≤–æ—Ä–∏—Ç—å –æ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ë–∞–π—Ç–æ–≤—ã–µ –ø–æ—Ç–æ–∫–∏ –¥–ª—è –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫—Ä–∞—Ç–∫–æ —É–ø–æ–º–∏–Ω–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ.

### 1.2. –ö–æ–Ω–≤–µ–π–µ—Ä

"–¢—É–Ω–Ω–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ" (piping) - —ç—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –æ–±—ä–µ–¥–∏–Ω—è—Ç—å (pipe) `RS` –∏ `WS`: –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ `RS` –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ, –¥–∞–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —á–∏—Ç–∞–µ—Ç –∏—Ö –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ `WS`. –ü—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ 2 –ø–æ—Ç–æ–∫–æ–≤ –º—ã –ø–æ–ª—É—á–∞–µ–º –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ–¥–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏ –≤ –¥—Ä—É–≥—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞). –û–¥–Ω–∞–∫–æ, –º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –±–æ–ª—å—à–µ 2 –ø–æ—Ç–æ–∫–æ–≤ –∏ –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–≤–µ–π–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏. –ü—Ä–∏–º–µ—Ä –∫–æ–Ω–≤–µ–π–µ—Ä–∞:

- –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `RS`;
- –∑–∞—Ç–µ–º —Å–ª–µ–¥—É–µ—Ç `TS`;
- —Ü–µ–ø–æ—á–∫–∞ (chain) –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è `WS`.

### 1.3. –ü—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ

–û–¥–Ω–æ–π –∏–∑ –ø—Ä–æ–±–ª–µ–º –∫–æ–Ω–≤–µ–π–µ—Ä–∞ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω –∏–∑ –∑–≤–µ–Ω—å–µ–≤ —Ü–µ–ø–æ—á–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö, —á–µ–º –º–æ–∂–µ–º –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç. –ü—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ (–æ–±—Ä–∞—Ç–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ) (backpressure) –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ—à–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É: –ø–æ–ª—É—á–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É –¥–∞–Ω–Ω—ã—Ö –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ (–ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è).

–î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ - —ç—Ç–æ —Å–∏–≥–Ω–∞–ª, –ø–µ—Ä–µ–¥–∞—é—â–∏–π—Å—è –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∑–≤–µ–Ω–∞ –∫ –Ω–∞—á–∞–ª—É —Ü–µ–ø–æ—á–∫–∏. –ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ —É –Ω–∞—Å –∏–º–µ–µ—Ç—Å—è —Ç–∞–∫–∞—è —Ü–µ–ø–æ—á–∫–∞:

```
RS -> TS -> WS
```

–ü—É—Ç—å –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∏–º:

- `WS` —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç, —á—Ç–æ –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö;
- –∫–æ–Ω–≤–µ–π–µ—Ä –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ `TS`;
- –¥–∞–Ω–Ω—ã–µ –∞–∫–∫—É–º—É–ª–∏—Ä—É—é—Ç—Å—è (–Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è) –≤–Ω—É—Ç—Ä–∏ `TS` (—ç—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–µ–π/buffering);
- `TS` —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏;
- –∫–æ–Ω–≤–µ–π–µ—Ä –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ `RS`.

–ú—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –Ω–∞—á–∞–ª–∞ —Ü–µ–ø–æ—á–∫–∏. –ü–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `RS`, —É `WS` –µ—Å—Ç—å –≤—Ä–µ–º—è –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ. –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è `WS` —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –ø–æ–ª—É—á–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ—Ç —Å–∏–≥–Ω–∞–ª —Ç–∞–∫–∂–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–æ —Ü–µ–ø–æ—á–∫–∏, –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.

### 1.4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Ç–æ–∫–æ–≤ –≤ `Node.js`

–í `Node.js` –ø–æ—Ç–æ–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ 2 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:

- –∏–∑ –º–æ–¥—É–ª—è `node:stream/web`;
- —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–∫–∞–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ).

–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω `API` –Ω–∞–ø—Ä—è–º—É—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ—Ç–æ–∫–∏ –≤ `Node.js` - `Fetch API`:

```javascript
const response = await fetch("https://exmple.com");
const readableStream = response.body;
```

–î–ª—è –≤—Å–µ–≥–æ –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤ –º–æ–¥—É–ª—è `node:stream` –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è `Node.js-–ø–æ—Ç–æ–∫–∞` –≤ –≤–µ–±-–ø–æ—Ç–æ–∫, –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç:

- `Readable`:
  - `Readable.toWeb(nodeReadable)`;
  - `Readable.fromWeb(webReadableStream, options?)`;
- `Writable`:
  - `Writable.toWeb(nodeWritable)`;
  - `Writable.fromWeb(webWritableStream, options)`;
- `Duplex`:
  - `Duplex.toWeb(nodeDuplex)`;
  - `Duplex.fromWeb(webTransformStream, options?)`.

`FileHandle` - –µ—â–µ –æ–¥–∏–Ω `API`, —á–∞—Å—Ç–∏—á–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π –ø–æ—Ç–æ–∫–∏ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `readableWebStream`.

## 2. –ß—Ç–µ–Ω–∏–µ –∏–∑ `RS`

`RS` –ø–æ–∑–≤–æ–ª—è—é—Ç —á–∏—Ç–∞—Ç—å —á–∞–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤. –û–Ω–∏ –∏–º–µ—é—Ç —Å–ª–µ–¥—É—é—â—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É:

```javascript
interface RS<TChunk> {
  getReader(): ReadableStreamDefaultReader<TChunk>;

  readonly locked: boolean;

  [Symbol.asyncIterator](): AsyncIterator<TChunk>;

  cancel(reason?: any): Promise<void>;

  pipeTo(
    destination: WS<TChunk>,
    options?: StreamPipeOptions
  ): Promise<void>;

  pipeThrough<TChunk2>(
    transform: ReadableWritablePair<TChunk2, TChunk>,
    options?: StreamPipeOptions
  ): RS<TChunk2>;

  // –ù–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è –≤ —Å—Ç–∞—Ç—å–µ
  tee(): [RS<TChunk>, RS<TChunk>];
}

interface StreamPipeOptions {
  signal?: AbortSignal;
  preventClose?: boolean;
  preventAbort?: boolean;
  preventCancel?: boolean;
}
```

–°–≤–æ–π—Å—Ç–≤–∞:

- `getReader()`: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Reader` - –æ–±—ä–µ–∫—Ç, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π —á–∏—Ç–∞—Ç—å –∏–∑ `RS`. `Readers` –ø–æ—Ö–æ–∂–∏ –Ω–∞ –∏—Ç–µ—Ä–∞—Ç–æ—Ä—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏;
- `locked`: –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω `Reader` –¥–ª—è –æ–¥–Ω–æ–≥–æ `RS`. `RS` –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `Reader`, `getReader()` –≤ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥ –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –Ω–µ –º–æ–∂–µ—Ç;
- `[Symbol.asyncIterator]()`: –¥–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –¥–µ–ª–∞–µ—Ç `RS` [–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º—ã–º–∏](https://exploringjs.com/impatient-js/ch_async-iteration.html). –í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –æ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º;
- `cancel()`: –æ—Ç–º–µ–Ω—è–µ—Ç –ø–æ—Ç–æ–∫, –ø–æ—Å–∫–æ–ª—å–∫—É –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –±–æ–ª—å—à–µ –≤ –Ω–µ–º –Ω–µ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω. `reason` (–ø—Ä–∏—á–∏–Ω–∞) –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –±–∞–∑–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ (underlying source) `RS` (–æ–± —ç—Ç–æ–º –ø–æ–∑–∂–µ). –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π –ø—Ä–æ–º–∏—Å —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏;
- `pipeTo()`: –ø–µ—Ä–µ–¥–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `RS` –≤ `WS`. –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π –ø—Ä–æ–º–∏—Å —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏. `pipeTo()` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –ø–µ—Ä–µ–¥–∞—á—É –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è, —Å–∏–≥–Ω–∞–ª–æ–≤ –∑–∞–∫—Ä—ã—Ç–∏—è, –æ—à–∏–±–æ–∫ –∏ —Ç.–ø. –ø–æ —Ü–µ–ø–æ—á–∫–µ. –í –∫–∞—á–µ—Å—Ç–≤–µ –≤—Ç–æ—Ä–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
  - `signal`: –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `AbortSignal` –¥–ª—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Ü–µ–ø–æ—á–∫–∏ —Å –ø–æ–º–æ—â—å—é `AbortController`;
  - `preventClose`: –µ—Å–ª–∏ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `true`, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ `WS` –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ `RS`. –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö `RS` –∫ –æ–¥–Ω–æ–º—É `WS`;
  - –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Å—Ç–∞—Ç—å–µ –Ω–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è. –ü–æ—á–∏—Ç–∞—Ç—å –æ –Ω–∏—Ö –º–æ–∂–Ω–æ [–∑–¥–µ—Å—å](https://streams.spec.whatwg.org/#rs-prototype);
- `pipeThrough()`: –ø–æ–¥–∫–ª—é—á–∞–µ—Ç `RS` –∫ `ReadableWritablePair` (–ø–æ —Å—É—Ç–∏, `TS`, –æ–± —ç—Ç–æ–º –ø–æ–∑–∂–µ). –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–π `RS` (—Å—Ç–æ—Ä–æ–Ω—É –¥–ª—è —á—Ç–µ–Ω–∏—è `ReadableWritablePair`).

–°—É—â–µ—Å—Ç–≤—É–µ—Ç 2 —Å–ø–æ—Å–æ–±–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è `RS`:

- `Readers`;
- –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä.

### 2.1. –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ `RS` —á–µ—Ä–µ–∑ `Readers`

–î–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ `RS` –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è `Readers`. –û–Ω–∏ –∏–º–µ—é—Ç —Å–ª–µ–¥—É—é—â—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É:

```javascript
interface ReadableStreamGenericReader {
  readonly closed: Promise<undefined>;
  cancel(reason?: any): Promise<void>;
}

interface ReadableStreamDefaultReader<TChunk>
  extends ReadableStreamGenericReader
{
  releaseLock(): void;
  read(): Promise<ReadableStreamReadResult<TChunk>>;
}

interface ReadableStreamReadResult<TChunk> {
  done: boolean;
  value: TChunk | undefined;
}
```

–°–≤–æ–π—Å—Ç–≤–∞:

- `closed`: –¥–∞–Ω–Ω—ã–π –ø—Ä–æ–º–∏—Å —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ—Ç–æ–∫–∞. –û–Ω –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ –∏–ª–∏ –≤ —Å–ª—É—á–∞–µ, –∫–æ–≥–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `Reader` —Å–Ω–∏–º–∞–µ—Ç—Å—è –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ—Ç–æ–∫–∞;
- `cancel()`: –≤ –∞–∫—Ç–∏–≤–Ω–æ–º `Reader` –¥–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –æ—Ç–º–µ–Ω—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π `RS`;
- `releaseLock()`: –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç `Reader` –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫;
- `read()`: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å –¥–ª—è `ReadableStreamReadResult` (–æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è —á–∞–Ω–∫–∞) —Å 2 —Å–≤–æ–π—Å—Ç–≤–∞–º–∏:
  - `done`: –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ - `false`, –µ—Å–ª–∏ —á–∞–Ω–∫–∏ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å—Å—è, `true` –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —á–∞–Ω–∫–∞;
  - `value`: —á–∞–Ω–∫ –∏–ª–∏ `undefined` –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —á–∞–Ω–∫–∞.

`RS` –ø–æ—Ö–æ–∂–∏ –Ω–∞ –∏—Ç–µ—Ä–∏—Ä—É–µ–º—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏, `Readers` - –Ω–∞ –∏—Ç–µ—Ä–∞—Ç–æ—Ä—ã, –∞ `ReadableStreamReadResult` - –Ω–∞ –æ–±—ä–µ–∫—Ç—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –º–µ—Ç–æ–¥–æ–º `next` –∏—Ç–µ—Ä–∞—Ç–æ—Ä–æ–≤.

–ö–æ–¥, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `Readers`:

```javascript
const reader = readableStream.getReader(); // 1

assert.equal(readableStream.locked, true); // 2

try {
  while (true) {
    const { done, value: chunk } = await reader.read(); // 3

    if (done) break;
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º `chunk`
  }
} finally {
  reader.releaseLock(); // 4
}
```

__–ü–æ–ª—É—á–µ–Ω–∏–µ `Reader`__. –ú—ã –º–æ–∂–µ–º —á–∏—Ç–∞—Ç—å –ø—Ä—è–º–æ –∏–∑ `RS`. –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º `Reader` (1). –ö–∞–∂–¥—ã–π `RS` –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω `Reader`. –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è `Reader` `RS` –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è (2). –ü–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –≤—ã–∑–æ–≤–æ–º `getReader()` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å `releaseLock()` (4).

__–ß—Ç–µ–Ω–∏–µ —á–∞–Ω–∫–æ–≤__. `read()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ —Å–æ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏ `done` –∏ `value` (3). –ü–æ—Å–ª–µ —á—Ç–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —á–∞–Ω–∫–∞ `done` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `true`. –≠—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ç–æ, –∫–∞–∫ –≤ `JS` —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä.

#### 2.1.1. –ü—Ä–∏–º–µ—Ä: —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ `RS`

–í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ —á–∏—Ç–∞—é—Ç—Å—è —á–∞–Ω–∫–∏ (—Å—Ç—Ä–æ–∫–∏) –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ `data.txt`:

```javascript
import * as fs from "node:fs";
import { Readable } from "node:stream";

const nodeReadable = fs.createReadStream(
  "data.txt",
  { encoding: "utf-8" }
);

const webReadableStream = Readable.toWeb(nodeReadable); // 1

const reader = webReadableStream.getReader();

try {
  while (true) {
    const { done, value } = await reader.read();

    if (done) break;

    console.log(value);
  }
} finally {
  reader.releaseLock();
}
```

–ü–æ—Ç–æ–∫ `Node.js` –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –≤–µ–±-–ø–æ—Ç–æ–∫. –ó–∞—Ç–µ–º –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–π –≤—ã—à–µ –ø—Ä–æ—Ç–æ–∫–æ–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —á—Ç–µ–Ω–∏—è —á–∞–Ω–∫–æ–≤.

#### 2.1.2. –ü—Ä–∏–º–µ—Ä: —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `RS`

–í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ —á–∞–Ω–∫–∏ –∏–∑ `RS` –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—É—é —Å—Ç—Ä–æ–∫—É:

```javascript
async function readableStreamToString(readableStream) {
  const reader = readableStream.getReader();

  try {
    let result = "";

    while (true) {
      const { done, value } = await reader.read();

      if (done) {
        return result; // 1
      }

      result += value;
    }
  } finally {
    reader.releaseLock(); // 2
  }
}
```

–ë–ª–æ–∫ `finally` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –±–ª–æ–∫–∞ `try`. –ü–æ—ç—Ç–æ–º—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–Ω–∏–º–∞–µ—Ç—Å—è (2) –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (1).

### 2.2. –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ `RS` —Å –ø–æ–º–æ—â—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–±–æ—Ä–∞

`RS` –º–æ–∂–Ω–æ –ø–æ—Ç—Ä–µ–±–ª—è—Ç—å —Å –ø–æ–º–æ—â—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–±–æ—Ä–∞:

```javascript
const iterator = readableStream[Symbol.iterator]();

let exhaustive = false;

try {
  while (true) {
    let chunk;

    ({ done: exhaustive, value: chunk } = await iterator.next());

    if (exhaustive) break;

    console.log(chunk);
  }
} finally {
  // –ï—Å–ª–∏ —Ü–∏–∫–ª –±—ã–ª –ø—Ä–µ—Ä–≤–∞–Ω –¥–æ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–≥–æ (exhaustive) –ø–µ—Ä–µ–±–æ—Ä–∞
  // (—á–µ—Ä–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ `return`), –º—ã –¥–æ–ª–∂–Ω—ã –≤—ã–∑–≤–∞—Ç—å `iterator.return`
  if (!exhaustive) {
    iterator.return();
  }
}
```

–ö —Å—á–∞—Å—Ç—å—é, —Ü–∏–∫–ª `for-await-of` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–±–æ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

```javascript
for await (const chunk of readableStream) {
  console.log(chunk);
}
```

#### 2.2.1. –ü—Ä–∏–º–µ—Ä: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–±–æ—Ä–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞

```javascript
import * as fs from "node:fs";
import { Readable } from "node:stream";

const nodeReadable = fs.createReadStream(
  "data.txt",
  { encoding: "utf-8" }
);

const webReadableStream = Readable.toWeb(nodeReadable);

for await (const chunk of webReadableStream) {
  console.log(chunk);
}
```

#### 2.2.2. –í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –±—Ä–∞—É–∑–µ—Ä—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä `RS`

–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä `RS` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è `Node.js` –∏ `Deno`, –Ω–æ –Ω–µ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ [–æ–±—Ä–∞—â–µ–Ω–∏–µ GitHub](https://github.com/whatwg/streams/issues/778).

–û–±–µ—Ä—Ç–∫–∞ –∏–∑ [–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤ –æ—Ç—á–µ—Ç–µ –æ –±–∞–≥–∞—Ö Chromium](https://bugs.chromium.org/p/chromium/issues/detail?id=929585#c10):

```javascript
async function* getAsyncIterableFor(readableStream) {
  const reader = readableStream.getReader();

  try {
    while (true) {
      const { done, value } = await reader.read();

      if (done) return;

      yield value;
    }
  } finally {
    reader.releaseLock();
  }
}
```

### 2.3. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω–≤–µ–π–µ—Ä–∞

`RS` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç 2 –º–µ—Ç–æ–¥–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω–≤–µ–π–µ—Ä–∞:

- `readableStream.pipeTo(writeableStream)`: —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å `p`. –û–Ω –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–∏—Ç–∞–µ—Ç –≤—Å–µ —á–∞–Ω–∫–∏ `RS` –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Ö –≤ `WS`. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —á—Ç–µ–Ω–∏—è `p` —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è.

–ú—ã —É–≤–∏–¥–∏–º –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `pipeTo()`, –∫–æ–≥–¥–∞ –±—É–¥–µ–º –≥–æ–≤–æ—Ä–∏—Ç—å –æ `WS`.

- `readableStream.pipeThrough(transformStream)` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç `RS` –∫ `transformStream.writable` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `transformStream.readable` (–∫–∞–∂–¥—ã–π `TS` —Å–æ–¥–µ—Ä–∂–∏—Ç —ç—Ç–∏ —Å–≤–æ–π—Å—Ç–≤–∞ –∏ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –∑–∞–ø–∏—Å—ã–≤–∞—é—â—É—é –∏ —á–∏—Ç–∞—é—â—É—é —Å—Ç–æ—Ä–æ–Ω—ã). –î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –¥–∞–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ `RS` –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è `TS` –∫ `RS`.

–ú—ã —É–≤–∏–¥–∏–º –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `pipeThrough()`, –∫–æ–≥–¥–∞ –±—É–¥–µ–º –≥–æ–≤–æ—Ä–∏—Ç—å –æ `TS`.

## 3. –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –≤ `RS` —Å –ø–æ–º–æ—â—å—é —É–ø–∞–∫–æ–≤–∫–∏

–î–ª—è —á—Ç–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å –ø–æ–º–æ—â—å—é `RS`, –µ–≥–æ –º–æ–∂–Ω–æ –æ–±–µ—Ä–Ω—É—Ç—å –≤ –æ–±—ä–µ–∫—Ç-–∞–¥–∞–ø—Ç–µ—Ä –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `RS`. –û–±—ä–µ–∫—Ç-–∞–¥–∞–ø—Ç–µ—Ä –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –±–∞–∑–æ–≤—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º (underlying source) `RS` (—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–º–µ—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å (queuing strategies) —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –Ω–∏–∂–µ, –≤ —Ä–∞–∑–¥–µ–ª–µ, –ø–æ—Å–≤—è—â–µ–Ω–Ω–æ–º –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—é):

```javascript
new ReadableStream(underlyingSource?, queuingStrategy?)
```

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–∞–∑–æ–≤—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:

```javascript
interface UnderlyingSource<TChunk> {
  start?(
    controller: ReadableStreamController<TChunk>
  ): void | Promise<void>;

  pull?(
    controller: ReadableStreamController<TChunk>
  ): void | Promise<void>;

  cancel?(reason?: any): void | Promise<void>;

  // –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –±–∞–π—Ç–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö –∏ –≤ –¥–∞–Ω–Ω–æ–º —Ä–∞–∑–¥–µ–ª–µ –Ω–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è
  type: "bytes" | undefined;
  autoAllocateChunkSize: bigint;
}
```

–≠—Ç–∏ –º–µ—Ç–æ–¥—ã –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ª—É—á–∞—è—Ö:

- `start(controller)`: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ `RS`;
- `pull(controller)`: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ (–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞, –∫–æ–º–Ω–∞—Ç—ã) (room) –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ—á–µ—Ä–µ–¥–∏ `RS`. –û–Ω –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –æ—á–µ—Ä–µ–¥—å –Ω–µ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∞. –î–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `start()`. –ï—Å–ª–∏ `pull()` –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å, –æ–Ω –±–æ–ª—å—à–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è;
- `cancel(reason)`: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å `RS` –≤—ã–∑—ã–≤–∞–µ—Ç `readableStream.cancel()` –∏–ª–∏ `reader.cancel().reason` —è–≤–ª—è–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ–º, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º —ç—Ç–∏–º –º–µ—Ç–æ–¥–∞–º.

–ö–∞–∂–¥—ã–π –∏–∑ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –ø—Ä–æ–º–∏—Å, –¥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ—Ç–æ—Ä–æ–≥–æ –¥—Ä—É–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –Ω–µ –±—É–¥—É—Ç. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á.

`controller`, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–π –≤ `start()` –∏ `pull()` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–º –ø–æ–ª—É—á–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ç–æ–∫—É. –û–Ω –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É:

```javascript
type ReadableStreamController<TChunk> =
  | ReadableStreamDefaultController<TChunk>
  // –Ω–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è
  | ReadableByteStreamController<TChunk>;

interface ReadableStreamDefaultController<TChunk> {
  enqueue(chunk?: TChunk): void;

  readonly desiredSize: number | null;

  close(): void;

  error(err?: any): void;
}
```

–ú–µ—Ç–æ–¥—ã (—á–∞–Ω–∫–∏ - —ç—Ç–æ —Å—Ç—Ä–æ–∫–∏):

- `enqueue(chunk)`: –ø–æ–º–µ—â–∞–µ—Ç `chunk` –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –æ—á–µ—Ä–µ–¥—å `RS`;
- `desiredSize`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –æ—á–µ—Ä–µ–¥–∏, –≤ –∫–æ—Ç–æ—Ä–æ–µ –ø–∏—à–µ—Ç `enqueue()`. –ò–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `0` –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ—á–µ—Ä–µ–¥–∏ –∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –æ—á–µ—Ä–µ–¥–∏. –ï—Å–ª–∏ –∂–µ–ª–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä (desired size) `<= 0`, –ø–æ–º–µ—â–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å —Å–ª–µ–¥—É–µ—Ç –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å;
  - –µ—Å–ª–∏ –ø–æ—Ç–æ–∫ –∑–∞–∫—Ä—ã—Ç, –µ–≥–æ `desiredSize` —Ä–∞–≤–µ–Ω `0`;
  - –µ—Å–ª–∏ –ø–æ—Ç–æ–∫ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ—à–∏–±–∫–∏, –µ–≥–æ `desiredSize` —Ä–∞–≤–µ–Ω `null`;
- `close()`: –∑–∞–∫—Ä—ã–≤–∞–µ—Ç `RS`. –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –±—É–¥—É –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–ø—É—Å—Ç–æ—à–∞—Ç—å –æ—á–µ—Ä–µ–¥—å, –Ω–æ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–æ—Ç–æ–∫ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è. –í–∞–∂–Ω–æ, —á—Ç–æ–±—ã –±–∞–∑–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –≤—ã–∑—ã–≤–∞–ª –¥–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥, –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ, —á—Ç–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è;
- `error(err)`: –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –ø–æ—Ç–æ–∫ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏ - –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –Ω–∏–º –±—É–¥—É—Ç –ø—Ä–æ–≤–∞–ª–∏–≤–∞—Ç—å—Å—è —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º `err`.

### 3.1. –ü–µ—Ä–≤—ã–π –ø—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑–æ–≤–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

–í –ø–µ—Ä–≤–æ–º –ø—Ä–∏–º–µ—Ä–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –º–µ—Ç–æ–¥ `start()`. –°–ª—É—á–∞–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `pull()` —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ:

```javascript
const readableStream = new ReadableStream({
  start(controller) {
    controller.enqueue("–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞\n"); // (1)
    controller.enqueue("–í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞\n"); // (2)
    controller.close(); // (3)
  },
});

for await (const chunk of readableStream) {
  console.log(chunk);
}
/**
 * –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞\n
 * –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞\n
*/
```

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Ç–æ–∫–∞ —Å 2 —á–∞–Ω–∫–∞–º–∏ (1 –∏ 2). –í–∞–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –ø–æ—Ç–æ–∫ (3). –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ, —Ü–∏–∫–ª `for-await-of` –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.

_–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ_: –¥–∞–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–º–µ—â–µ–Ω–∏—è —á–∞–Ω–∫–æ–≤ –≤ –æ—á–µ—Ä–µ–¥—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑–æ–ø–∞—Å–Ω—ã–º - —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ä–∏—Å–∫ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ—á–µ—Ä–µ–¥–∏. –°–∫–æ—Ä–æ –º—ã —É–≤–∏–¥–∏–º, –∫–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å —Ç–∞–∫–æ–≥–æ —Ä–∏—Å–∫–∞.

### 3.2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `RS` –¥–ª—è –æ–±–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è push- –∏–ª–∏ pull-–∏—Å—Ç–æ—á–Ω–∏–∫–∞

–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–º —Å—Ü–µ–Ω–∞—Ä–∏–µ–º —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ push- –∏–ª–∏ pull-–∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ `RS`. –í–∏–¥ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (push –∏–ª–∏ pull) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ –º—ã –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ `RS` –∏–∑ `UnderlyingSource`:

- push-–∏—Å—Ç–æ—á–Ω–∏–∫: —Ç–∞–∫–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ —É–≤–µ–¥–æ–º–ª—è–µ—Ç –Ω–∞—Å –æ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ `start`. –ï—Å–ª–∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∏ –∂–µ–ª–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –ø–µ—Ä–µ—Å—Ç–∞–ª –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º, –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è. –ü—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–º –≤—ã–∑–æ–≤–µ `pull()` –∏—Å—Ç–æ—á–Ω–∏–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω. –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∂–µ–ª–∞–µ–º–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è (applying backpressure);
- pull-–∏—Å—Ç–æ—á–Ω–∏–∫: —Ç–∞–∫–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö - —á–∞—Å—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ. –ü–æ—ç—Ç–æ–º—É, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `pull()`, –∞ –Ω–µ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `start()`.

#### 3.2.1. –ü—Ä–∏–º–µ—Ä: —Å–æ–∑–¥–∞–Ω–∏–µ `RS` –∏–∑ push-–∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è

–í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ `RS` –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Å–æ–∫–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π "–ø—É—à–∏—Ç" –Ω–∞–º –¥–∞–Ω–Ω—ã–µ (–≤—ã–∑—ã–≤–∞–µ—Ç –Ω–∞—Å):

```javascript
function makeReadableBackpressureSocketStream(host, port) {
  const socket = createBackpressureSocket(host, port);

  return new RS({
    start(controller) {
      socket.ondata = (event) => {
        controller.enqueue(event.data);

        if (controller.desiredSize <= 0) {
          // –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—á–µ—Ä–µ–¥—å –∑–∞–ø–æ–ª–Ω–∏–ª–∞—Å—å, –ø–µ—Ä–µ–¥–∞–µ–º
          // —Å–∏–≥–Ω–∞–ª –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–≤–æ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É
          socket.readStop();
        }
      };

      socket.onend = () => controller.close();

      socket.onerror = () => controller.error(
        new Error("–í–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞!"));
    },

    pull() {
      // –î–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—á–µ—Ä–µ–¥—å –æ–ø—É—Å—Ç–µ–ª–∞, –Ω–æ
      // –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –ø–æ—Ç–æ–∫–∞ —Ö–æ—á–µ—Ç –µ—â–µ –¥–∞–Ω–Ω—ã—Ö.
      // –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–Ω–µ–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
      socket.readStart();
    },

    cancel() {
      socket.close();
    },
  });
}
```

#### 3.2.2. –ü—Ä–∏–º–µ—Ä: —Å–æ–∑–¥–∞–Ω–∏–µ `RS` –∏–∑ pull-–∏—Å—Ç–æ—á–Ω–∏–∫–∞

–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `iterableToReadableStream` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏—Ç–µ—Ä–∏—Ä—É–µ–º—É—é —Å—É—â–Ω–æ—Å—Ç—å —Å —á–∞–Ω–∫–∞–º–∏ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∏—Ö –≤ `RS`:

```javascript
/**
 * @param iterable –∏—Ç–µ—Ä–∏—Ä—É–µ–º–∞—è —Å—É—â–Ω–æ—Å—Ç—å (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è)
 */
 function iterableToReadableStream(iterable) {
  return new RS({
    start() {
      if (typeof iterable[Symbol.asyncIterator] === "function") {

        this.iterator = iterable[Symbol.asyncIterator]();

      } else if (typeof iterable[Symbol.iterator] === "function") {

        this.iterator = iterable[Symbol.iterator]();

      } else {
        throw new Error(iterable + " –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏—Ç–µ—Ä–∏—Ä—É–µ–º–æ–π —Å—É—â–Ω–æ—Å—Ç—å—é");
      }
    },

    async pull(controller) {
      if (this.iterator === null) return;
      // –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∏—Ç–µ—Ä–∞—Ç–æ—Ä—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–±—ã—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–µ –ø—Ä–æ–º–∏—Å—ã)
      // –æ–¥–Ω–∞–∫–æ –¥–ª—è `await` —ç—Ç–æ –Ω–µ–≤–∞–∂–Ω–æ, –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –¥–∞–ª—å—à–µ
      const { value, done } = await this.iterator.next();

      if (done) {
        this.iterator = null;
        controller.close();
        return;
      }

      controller.enqueue(value);
    },

    cancel() {
      this.iterator = null;
      controller.close();
    },
  });
}
```

–°–æ–∑–¥–∞–¥–∏–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –µ–µ –≤ `RS`:

```javascript
async function* genAsyncIterable() {
  yield "–∫–∞–∫";
  yield "—Ç–≤–æ–∏";
  yield "–¥–µ–ª–∞?";
}

const readableStream = iterableToReadableStream(genAsyncIterable());

for await (const chunk of readableStream) {
  console.log(chunk);
}
/**
 * –∫–∞–∫
 * —Ç–≤–æ–∏
 * –¥–µ–ª–∞?
*/

// iterableToReadableStream() —Ç–∞–∫–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏
const syncIterable = ["–≤—Å–µ–º", "–ø—Ä–∏–≤–µ—Ç"];

const readableStream = iterableToReadableStream(syncIterable);

for await (const chunk of readableStream) {
  console.log(chunk);
}
/**
 * –≤—Å–µ–º
 * –ø—Ä–∏–≤–µ—Ç
*/
```

–í–æ–∑–º–æ–∂–Ω–æ, –≤ –±—É–¥—É—â–µ–º –ø–æ—è–≤–∏—Ç—Å—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ `RS.from()`, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π —ç—Ç–æ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏–∑ –∫–æ—Ä–æ–±–∫–∏ (—Å–º. [—ç—Ç–æ—Ç –ø—É–ª-—Ä–µ–∫–≤–µ—Å—Ç](https://github.com/whatwg/streams/pull/1083)).

## 4. –ó–∞–ø–∏—Å—å –≤ `WS`

`WS` –ø–æ–∑–≤–æ–ª—è—é—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —á–∞–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–∑–Ω—ã–µ –ø—Ä–∏–µ–º–Ω–∏–∫–∏. –û–Ω–∏ –∏–º–µ—é—Ç —Å–ª–µ–¥—É—é—â—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É:

```javascript
interface WS<TChunk> {
  getWriter(): WritableStreamDefaultWriter<TChunk>;

  readonly locked: boolean;

  close(): Promise<void>;

  abort(reason?: any): Promise<void>;
}
```

–°–≤–æ–π—Å—Ç–≤–∞:

- `getWriter()`: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Writer` - –æ–±—ä–µ–∫—Ç, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `WS`;
- `locked`: –æ–¥–∏–Ω `WS` –º–æ–∂–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏–º–µ—Ç—å –æ–¥–Ω–æ–≥–æ `Writer`. –î–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ `Writer` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, `WS` –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –∞ –º–µ—Ç–æ–¥ `getWriter()` –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –Ω–µ –º–æ–∂–µ—Ç;
- `close()`: –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ç–æ–∫:
  - –±–∞–∑–æ–≤—ã–π –ø—Ä–∏–µ–º–Ω–∏–∫ (underlying sink) (–æ–± —ç—Ç–æ–º –ø–æ–∑–∂–µ) –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —á–∞–Ω–∫–∏ –∏–∑ –æ—á–µ—Ä–µ–¥–∏;
  - –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–ø–∏—Å–∏ —Ç–∏—Ö–æ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è –Ω–∏—á–µ–º (–±–µ–∑ –æ—à–∏–±–æ–∫);
  - –º–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–ø–∏—Å–∏ –≤ –ø—Ä–∏–µ–º–Ω–∏–∫ –≤—Å–µ—Ö —á–∞–Ω–∫–æ–≤ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–µ–º–Ω–∏–∫–∞. –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ –ø—Ä–æ–º–∏—Å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è;
- `abort()`: –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –ø–æ—Ç–æ–∫:
  - –ø–æ—Ç–æ–∫ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏;
  - –ø—Ä–æ–º–∏—Å —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–µ–º–Ω–∏–∫–∞ –∏ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏.

–°—É—â–µ—Å—Ç–≤—É–µ—Ç 2 —Å–ø–æ—Å–æ–±–∞ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ `WS`:

- —Å –ø–æ–º–æ—â—å—é `Writers`;
- —á–µ—Ä–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `WS`.

### 4.1. –ó–∞–ø–∏—Å—å –≤ `WS` —Å –ø–æ–º–æ—â—å—é `Writers`

`Writers` –∏–º–µ—é—Ç —Å–ª–µ–¥—É—é—â—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É:

```javascript
interface WritableStreamDefaultWriter<TChunk> {
  readonly desiredSize: number | null;

  readonly ready: Promise<undefined>;

  write(chunk?: TChunk): Promise<void>;

  releaseLock(): void;

  close(): Promise<void>;

  readonly closed: Promise<undefined>;

  abort(reason?: any): Promise<void>;
}
```

–°–≤–æ–π—Å—Ç–≤–∞:

- `desiredSize`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –æ—á–µ—Ä–µ–¥–∏ `WS`. –ï—Å–ª–∏ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `0`, –∑–Ω–∞—á–∏—Ç, –æ—á–µ—Ä–µ–¥—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∞, –µ—Å–ª–∏ –∏–º–µ–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ - –ø—Ä–µ–≤—ã—à–µ–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –µ—Å–ª–∏ –∂–µ–ª–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä `<= 0`, –∑–∞–ø–∏—Å—å —Å–ª–µ–¥—É–µ—Ç –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å;
  - –µ—Å–ª–∏ –ø–æ—Ç–æ–∫ –∑–∞–∫—Ä—ã—Ç, –∂–µ–ª–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä —Ä–∞–≤–µ–Ω `0`;
  - –µ—Å–ª–∏ –ø–æ—Ç–æ–∫ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ—à–∏–±–∫–∏, –∂–µ–ª–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä —Ä–∞–≤–µ–Ω `null`;
- `ready`: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∂–µ–ª–∞–µ–º—ã–º —Ä–∞–∑–º–µ—Ä–æ–º –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∞. –ï—Å–ª–∏ –∂–µ–ª–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –≤–Ω–æ–≤—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è non-positive, —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –æ–∂–∏–¥–∞—é—â–∏–π (pending) –ø—Ä–æ–º–∏—Å;
- `write()`: –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —á–∞–Ω–∫ –≤ –ø–æ—Ç–æ–∫. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ –∏ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ;
- `releaseLock()`: —Å–Ω–∏–º–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ø–æ—Ç–æ–∫–∞;
- `close()`: –∏–º–µ–µ—Ç —Ç–æ—Ç –∂–µ —ç—Ñ—Ñ–µ–∫—Ç, —á—Ç–æ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ—Ç–æ–∫–∞;
- `closed`: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å, —Ä–∞–∑—Ä–µ—à–∞—é—â–∏–π—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ—Ç–æ–∫–∞;
- `abort()`: –∏–º–µ–µ—Ç —Ç–æ—Ç –∂–µ —ç—Ñ—Ñ–µ–∫—Ç, —á—Ç–æ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–∞.

–ö–æ–¥, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `Writers`:

```javascript
const writer = writableStream.getWriter(); // (1)

assert.equal(writableStream.locked, true); // (2)

try {
  // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —á–∞–Ω–∫–∏ (–æ–± —ç—Ç–æ–º –ø–æ–∑–∂–µ)
} finally {
  writer.releaseLock(); // (3)
}
```

–ú—ã –º–æ–∂–µ–º –ø–∏—Å–∞—Ç—å –ø—Ä—è–º–æ –≤ `WS`. –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è `Writer` (1). –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è `Writer` `WS` –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è (2). –ü–µ—Ä–µ–¥ –ø–æ—Å–ª–µ–¥—É—é—â–∏–º –≤—ã–∑–æ–≤–æ–º `getWriter()` —Å–ª–µ–¥—É–µ—Ç –≤—ã–∑–≤–∞—Ç—å `releaseLock()` (3).

–°—É—â–µ—Å—Ç–≤—É–µ—Ç 3 —Å–ø–æ—Å–æ–±–∞ –∑–∞–ø–∏—Å–∏ —á–∞–Ω–∫–æ–≤.

#### 4.1.1. –ü–æ–¥—Ö–æ–¥ 1: –æ–∂–∏–¥–∞–Ω–∏–µ `write()` (–Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è)

–ü–µ—Ä–≤—ã–π –ø–æ–¥—Ö–æ–¥ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ `write()`:

```javascript
await writer.write("–ß–∞–Ω–∫ 1");
await writer.write("–ß–∞–Ω–∫ 2");
await writer.close();
```

–ü—Ä–æ–º–∏—Å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π `write()`, —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–ø–∏—Å–∏ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ —á–∞–Ω–∫–∞. –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç "—É—Å–ø–µ—à–Ω–∞—è –∑–∞–ø–∏—Å—å", –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `WS`, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Å–ª—É—á–∞–µ —Å —Ñ–∞–π–ª–æ–º, —á–∞–Ω–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É, –Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –∫–µ—à–µ, —Ç.–µ. –Ω–µ –±—ã—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–º –Ω–∞ –¥–∏—Å–∫.

–ü—Ä–æ–º–∏—Å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π `close()`, —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ—Ç–æ–∫–∞.

–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –¥–∞–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥—è: –æ–∂–∏–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–ø–∏—Å–∏ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ—á–µ—Ä–µ–¥—å –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è. –ö–∞–∫ —Å–ª–µ–¥—Å—Ç–≤–∏–µ, —Å–Ω–∏–∂–∞–µ—Ç—Å—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö.

#### 4.1.2. –ü–æ–¥—Ö–æ–¥ 2: –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è `write()` (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è)

–í—Ç–æ—Ä–æ–π –ø–æ–¥—Ö–æ–¥ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–∏—Å–æ–≤, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö `write()`, –∏ –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ–º–∏—Å–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ `close()`:

```javascript
writer.write("–ß–∞–Ω–∫ 1").catch(() => {}); // (1)
writer.write("–ß–∞–Ω–∫ 2").catch(() => {}); // (2)
await writer.close(); // C–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
```

–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ `write()` –ø–æ–º–µ—â–∞–µ—Ç —á–∞–Ω–∫–∏ –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –æ—á–µ—Ä–µ–¥—å `WS`. –ú—ã –Ω–µ –∂–¥–µ–º –∑–∞–ø–∏—Å–∏ —á–∞–Ω–∫–æ–≤. –û–¥–Ω–∞–∫–æ –æ–∂–∏–¥–∞–Ω–∏–µ `close()` –æ–∑–Ω–∞—á–∞–µ—Ç –æ–∂–∏–¥–∞–Ω–∏–µ –æ–ø—É—Å—Ç–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏ –∏ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–ø–∏—Å–∏ —á–∞–Ω–∫–æ–≤.

–í—ã–∑–æ–≤ `catch()` (1 –∏ 2) –Ω–µ–æ–±—Ö–æ–¥–∏–º, –ø–æ—Å–∫–æ–ª—å–∫—É –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è—Ö –ø—Ä–æ–º–∏—Å–∞ –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å –∑–∞–ø–∏—Å—å—é. –ú—ã –º–æ–∂–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ `write()`, –ø–æ—Ç–æ–º—É —á—Ç–æ `close()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∞–∫–∏–µ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏—è.

–ú–æ–∂–Ω–æ –¥–∞–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π:

```javascript
ignoreRejections(
  writer.write("–ß–∞–Ω–∫ 1"),
  writer.write("–ß–∞–Ω–∫ 2"),
);
await writer.close(); // –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

function ignoreRejections(...promises) {
  for (const promise of promises) {
    promise.catch(() => {});
  }
}
```

–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –¥–∞–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞: –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è. –ú—ã –ø—Ä–æ—Å—Ç–æ –∏—Å—Ö–æ–¥–∏–º –∏–∑ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è, —á—Ç–æ –æ—á–µ—Ä–µ–¥—å —è–≤–ª—è–µ—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–æ–π –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è.

#### 4.1.3. –ü–æ–¥—Ö–æ–¥ 3: –æ–∂–∏–¥–∞–Ω–∏–µ `ready` (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è)

–û–∂–∏–¥–∞–Ω–∏–µ –≥–µ—Ç—Ç–µ—Ä–∞ `ready` –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ:

```javascript
await writer.ready; // –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
// –°–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞?
console.log(writer.desiredSize);
writer.write("–ß–∞–Ω–∫ 1").catch(() => {});

await writer.ready; // –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
// –°–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞?
console.log(writer.desiredSize);
writer.write("–ß–∞–Ω–∫ 2").catch(() => {});

await writer.close(); // –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
```

–ü—Ä–æ–º–∏—Å –≤ `ready` —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ—Ç–æ–∫–∞ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞–ª–∏—á–∏—è –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é –µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è.

#### 4.1.4. –ü—Ä–∏–º–µ—Ä: –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–∞ —Å –ø–æ–º–æ—â—å—é `Writer`

```javascript
import * as fs from "node:fs";
import { Writable } from "node:stream";

const nodeWritable = fs.createWriteStream(
  "data.txt",
  { encoding: "utf-8" }
); // (1)

const webWritableStream = Writable.toWeb(nodeWritable); // (2)

const writer = webWritableStream.getWriter();

try {
  await writer.write("–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞\n");
  await writer.write("–í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞\n");
  await writer.close();
} finally {
  writer.releaseLock()
}
```

–°–æ–∑–¥–∞–µ–º –ø–æ—Ç–æ–∫ `Node.js` –¥–ª—è —Ñ–∞–π–ª–∞ `data.txt` (1). –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —ç—Ç–æ—Ç –ø–æ—Ç–æ–∫ –≤ –≤–µ–±-–ø–æ—Ç–æ–∫ (2). –ò—Å–ø–æ–ª—å–∑—É–µ–º `Writer` –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ –Ω–µ–≥–æ —Å—Ç—Ä–æ–∫.

### 4.2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `WS`

–í–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `Writers`, –≤ `WS` –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –ø—Ä—è–º–æ –∏–∑ `RS`:

```javascript
await readableStream.pipeTo(writableStream);
```

–ü—Ä–æ–º–∏—Å –∏–∑ `pipeTo()` —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏.

#### 4.2.1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–ª–∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏. –≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:

```javascript
const readableStream = new RS({ // (1)
  start(controller) {
    controller.enqueue("–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞\n");
    controller.enqueue("–í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞\n");
    controller.close();
  },
});

const writableStream = new WritableStream({ // (2)
  write(chunk) {
    console.log("–ó–ê–ü–ò–°–¨ " + JSON.stringify(chunk));
  },

  close() {
    console.log("–ó–ê–ö–†–´–¢–ò–ï WS");
  },
});


console.log("–î–æ .pipeTo()");

const promise = readableStream.pipeTo(writableStream); // (3)

promise.then(() => console.log("–ü—Ä–æ–º–∏—Å —Ä–∞–∑—Ä–µ—à–µ–Ω"));

console.log("–ü–æ—Å–ª–µ .pipeTo()");
/**
 * –î–æ .pipeTo()
 * –ü–æ—Å–ª–µ .pipeTo()
 * –ó–ê–ü–ò–°–¨ "–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞\n"
 * –ó–ê–ü–ò–°–¨ "–í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞\n"
 * –ó–ê–ö–†–´–¢–ò–ï WS
 * –ü—Ä–æ–º–∏—Å —Ä–∞–∑—Ä–µ—à–µ–Ω
*/
```

–°–æ–∑–¥–∞–µ–º `RS` (1). –°–æ–∑–¥–∞–µ–º `WS` (2).

–í–∏–¥–∏–º, —á—Ç–æ `pipeTo()` (3) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ–∑–∞–º–µ–¥–ª–∏—Ç–µ–ª—å–Ω–æ. –í –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ —á–∞–Ω–∫–∏ —á–∏—Ç–∞—é—Ç—Å—è –∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è. –ó–∞—Ç–µ–º `WS` –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏ `promise` —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è.

#### 4.2.2. –ü—Ä–∏–º–µ—Ä: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `WS` –¥–ª—è —Ñ–∞–π–ª–∞

–í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã —Å–æ–∑–¥–∞–µ–º `WS` –¥–ª—è —Ñ–∞–π–ª–∞ –∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º –∫ –Ω–µ–º—É `RS`:

```javascript
const webReadableStream = new RS({ // (1)
  async start(controller) {
    controller.enqueue("–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞\n");
    controller.enqueue("–í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞\n");
    controller.close();
  },
});

const nodeWritable = fs.createWriteStream( // (2)
  "data.txt",
  { encoding: "utf-8" }
);

const webWritableStream = Writable.toWeb(nodeWritable); // (3)

await webReadableStream.pipeTo(webWritableStream); // (4)
```

–°–æ–∑–¥–∞–µ–º `RS` (1). –°–æ–∑–¥–∞–µ–º –ø–æ—Ç–æ–∫ `Node.js` –¥–ª—è —Ñ–∞–π–ª–∞ `data.txt` (2). –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –≤ –≤–µ–±-–ø–æ—Ç–æ–∫ (3). –ü–æ–¥–∫–ª—é—á–∞–µ–º `webReadableStream` –∫ `RS` –¥–ª—è —Ñ–∞–π–ª–∞.

#### 4.2.3. –ü—Ä–∏–º–µ—Ä: –∑–∞–ø–∏—Å—å –¥–≤—É—Ö `RS` –≤ –æ–¥–∏–Ω `WS`

```javascript
const createReadableStream = (prefix) =>
  new ReadableStream({
    async start(controller) {
      controller.enqueue(prefix + "—á–∞–Ω–∫ 1");
      controller.enqueue(prefix + "—á–∞–Ω–∫ 2");
      controller.close();
    },
  });

const writableStream = new WritableStream({
  write(chunk) {
    console.log("–ó–ê–ü–ò–°–¨ " + JSON.stringify(chunk));
  },

  close() {
    console.log("–ó–ê–ö–†–´–¢–ò–ï");
  },

  abort(err) {
    console.log("–ü–†–ï–†–´–í–ê–ù–ò–ï " + err);
  },
});

await createReadableStream("–ü–æ—Ç–æ–∫ 1: ")
  .pipeTo(writableStream, { preventClose: true }); // (1)

await createReadableStream("–ü–æ—Ç–æ–∫ 2: ")
  .pipeTo(writableStream, { preventClose: true }); // (2)

await writableStream.close();
/**
 * –ó–ê–ü–ò–°–¨ "–ü–æ—Ç–æ–∫ 1: —á–∞–Ω–∫ 1"
 * –ó–ê–ü–ò–°–¨ "–ü–æ—Ç–æ–∫ 1: —á–∞–Ω–∫ 2"
 * –ó–ê–ü–ò–°–¨ "–ü–æ—Ç–æ–∫ 2: —á–∞–Ω–∫ 1"
 * –ó–ê–ü–ò–°–¨ "–ü–æ—Ç–æ–∫ 2: —á–∞–Ω–∫ 2"
 * –ó–ê–ö–†–´–¢–ò–ï
*/
```

–ú—ã —É–∫–∞–∑—ã–≤–∞–µ–º `pipeTo()` –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å `WS` –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è `RS` (1 –∏ 2). –ü–æ—ç—Ç–æ–º—É `WS` –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º, –∏ –∫ –Ω–µ–º—É –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –¥—Ä—É–≥–∏–µ `RS`.

## 5. –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–∏–µ–º–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –≤ `WS` —Å –ø–æ–º–æ—â—å—é —É–ø–∞–∫–æ–≤–∫–∏

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–æ –≤–Ω–µ—à–Ω–∏–π –ø—Ä–∏–µ–º–Ω–∏–∫ —á–µ—Ä–µ–∑ `WS`, —ç—Ç–æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–µ—Ä–Ω—É—Ç—å –≤ –æ–±—ä–µ–∫—Ç-–∞–¥–∞–ø—Ç–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –±–∞–∑–æ–≤—ã–º –ø—Ä–∏–µ–º–Ω–∏–∫–æ–º (underlying sink):

```javascript
new WritableStream(underlyingSink?, queuingStrategy?);
```

–ë–∞–∑–æ–≤—ã–µ –ø—Ä–∏–µ–º–Ω–∏–∫–∏ –∏–º–µ—é—Ç —Å–ª–µ–¥—É—é—â—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É:

```javascript
interface UnderlyingSink<TChunk> {
  start?(
    controller: WritableStreamDefaultController
  ): void | Promise<void>;

  write?(
    chunk: TChunk,
    controller: WritableStreamDefaultController
  ): void | Promise<void>;

  close?(): void | Promise<void>;

  abort?(reason?: any): void | Promise<void>;
}
```

–°–≤–æ–π—Å—Ç–≤–∞:

- `start(controller)`: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ `WS`. –î–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –º–æ–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—Ä–æ–º–∏—Å. –î–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –∑–∞–ø–∏—Å–∏;
- `write(chunk, controller)`: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –Ω–æ–≤–æ–≥–æ —á–∞–Ω–∫–∞ –∫ –∑–∞–ø–∏—Å–∏ –≤ –ø—Ä–∏–µ–º–Ω–∏–∫. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ, –≤–æ–∑–≤—Ä–∞—â–∞—è –ø—Ä–æ–º–∏—Å, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è;
- `close()`: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `writeStream.close()` –∏ –∑–∞–ø–∏—Å–∏ –≤—Å–µ—Ö —á–∞–Ω–∫–æ–≤ –∏–∑ –æ—á–µ—Ä–µ–¥–∏. –î–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ—á–∏—Å—Ç–∫—É –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏;
- `abort(reason)`: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Å–ª—É—á–∞–µ –≤—ã–∑–æ–≤–∞ `writeStream.abort()` –∏–ª–∏ `writer.abort()`. `reason` - —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ, –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ —ç—Ç–∏–º –º–µ—Ç–æ–¥–∞–º.

–ü–∞—Ä–∞–º–µ—Ç—Ä `controller` –º–µ—Ç–æ–¥–æ–≤ `start` –∏ `write` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å `WS` –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏. –û–Ω –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É:

```javascript
interface WritableStreamDefaultController {
  readonly signal: AbortSignal;
  error(err?: any): void;
}
```

- `signal`: `AbortSignal`, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –ø—Ä–µ—Ä—ã–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –∏–ª–∏ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ—Ç–æ–∫–∞;
- `error(err)`: –∑–∞–∫—Ä—ã–≤–∞–µ—Ç `WS`, –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –Ω–∏–º –±—É–¥—É –ø—Ä–æ–≤–∞–ª–∏–≤–∞—Ç—å—Å—è —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º `err`.

### 5.1. –ü—Ä–∏–º–µ—Ä: —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ `RS`

–í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ `RS` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ `WS` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç–æ–≥–æ, –∫–∞–∫ `RS` –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç —á–∞–Ω–∫–∏:

```javascript
const readableStream = new RS({
  start(controller) {
    controller.enqueue("–ü–µ—Ä–≤—ã–π —á–∞–Ω–∫");
    controller.enqueue("–í—Ç–æ—Ä–æ–π —á–∞–Ω–∫");
    controller.close();
  },
});

await readableStream.pipeTo(
  new WritableStream({
    write(chunk) {
      console.log("–ó–ê–ü–ò–°–¨ " + JSON.stringify(chunk));
    },

    close() {
      console.log("–ó–ê–ö–†–´–¢–ò–ï");
    },

    abort(err) {
      console.log("–ü–†–ï–†–´–í–ê–ù–ò–ï " + err);
    },
  })
);
/**
 * –ó–ê–ü–ò–°–¨ "–ü–µ—Ä–≤—ã–π —á–∞–Ω–∫"
 * –ó–ê–ü–ò–°–¨ "–í—Ç–æ—Ä–æ–π —á–∞–Ω–∫"
 * –ó–ê–ö–†–´–¢–ò–ï
*/
```

### 5.2. –ü—Ä–∏–º–µ—Ä: —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º—ã—Ö —á–∞–Ω–∫–æ–≤

–í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã —Å–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª–∞—Å—Å `WS`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º—ã–µ —á–∞–Ω–∫–∏ –≤ —Å—Ç—Ä–æ–∫—É. –ú–µ—Ç–æ–¥ `getString` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å—Ç—Ä–æ–∫–µ:

```javascript
class WritableStringStream extends WS {
  #string = "";

  constructor() {
    super({
      // –ù–∞–º –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ `this` `WritableStringStream`,
      // –ø–æ—ç—Ç–æ–º—É –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä–µ–ª–æ—á–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
      write: (chunk) => {
        this.#string += chunk;
      },
    });
  }

  getString() {
    return this.#string;
  }
}

const stringStream = new WritableStringStream();

const writer = stringStream.getWriter();

try {
  await writer.write("–ö–∞–∫");
  await writer.write(" —Ç–≤–æ–∏ ");
  await writer.write(" –¥–µ–ª–∞?");
  await writer.close();
} finally {
  writer.releaseLock()
}

assert.equal(
  stringStream.getString(),
  "–ö–∞–∫ —Ç–≤–æ–∏ –¥–µ–ª–∞?"
);
```

–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–º –¥–∞–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ —è–≤–ª—è–µ—Ç—Å—è —Å–º–µ—à–µ–Ω–∏–µ `API`: `WS API` –∏ `API` –Ω–∞—à–µ–≥–æ —Å—Ç—Ä–æ–∫–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–æ–π —è–≤–ª—è–µ—Ç—Å—è –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ `WS` –≤–º–µ—Å—Ç–æ –µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:

```javascript
function createWritableStringStream() {
  let string = "";

  return {
    stream: new WS({
      write(chunk) {
        string += chunk;
      },
    }),

    getString() {
      return string;
    },
  };
}

const stringStream = createWritableStringStream();

const writer = stringStream.stream.getWriter();

try {
  await writer.write("–ö–∞–∫");
  await writer.write(" —Ç–≤–æ–∏ ");
  await writer.write(" –¥–µ–ª–∞?");
  await writer.close();
} finally {
  writer.releaseLock()
}

assert.equal(
  stringStream.getString(),
  "–ö–∞–∫ —Ç–≤–æ–∏ –¥–µ–ª–∞?"
);
```

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å –ø–æ–º–æ—â—å—é –∫–ª–∞—Å—Å–∞ (–≤–º–µ—Å—Ç–æ —Ñ–∞–±—Ä–∏—á–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤).

## 6. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `TS`

`TS`:

- –ø–æ–ª—É—á–∞–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Å—Ç–æ—Ä–æ–Ω—É –¥–ª—è –∑–∞–ø–∏—Å–∏ (writable side), `WS`;
- –º–æ–∂–µ—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ;
- –ø–æ–∑–≤–æ–ª—è–µ—Ç —á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ —Å—Ç–æ—Ä–æ–Ω—É –¥–ª—è —á—Ç–µ–Ω–∏—è (readable side), `RS`.

–û—Å–Ω–æ–≤–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è `TS` —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–ø—É—Å–∫–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö (pipe through) –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:

```javascript
const transformedStream = readableStream.pipeThrough(transformStream);
```

`pipeThrough()` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç `RS` –∫ —Å—Ç–æ—Ä–æ–Ω–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ `TS` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ —Å—Ç–æ—Ä–æ–Ω—É –¥–ª—è —á—Ç–µ–Ω–∏—è. –î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π `RS`, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π `RS`.

`pipeThrough()` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ `TS`, –Ω–æ —Ç–∞–∫–∂–µ –ª—é–±–æ–π –æ–±—ä–µ–∫—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–∞–∫–æ–º—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É:

```javascript
interface ReadableWritablePair<RChunk, WChunk> {
  readable: RS<RChunk>;
  writable: WS<WChunk>;
}
```

### 6.1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ `TS`

`Node.js` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ `TS`:

- [–ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç WHATWG)](https://encoding.spec.whatwg.org/) - [TextEncoderStream](https://developer.mozilla.org/en-US/docs/Web/API/TextEncoderStream#browser_compatibility) –∏ [TextDecoderStream](https://developer.mozilla.org/en-US/docs/Web/API/TextDecoderStream#browser_compatibility):
  - –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –Ω–µ —Ç–æ–ª—å–∫–æ `UTF-8`, –Ω–æ –∏ –º–Ω–æ–≥–∏–µ [—É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏](https://encoding.spec.whatwg.org/#names-and-labels);
  - –µ–¥–∏–Ω–∏—á–Ω–∞—è –∫–æ–¥–æ–≤–∞—è —Ç–æ—á–∫–∞ (code point) –Æ–Ω–∏–∫–æ–¥–∞ –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –≤ –µ–¥–∏–Ω–∏—Ü—ã –∫–æ–¥–∞ `UFT-8`, —Ä–∞–∑–º–µ—Ä–æ–º –¥–æ 4 –±–∞–π—Ç. –í –±–∞–π—Ç–æ–≤—ã–π –ø–æ—Ç–æ–∫–∞—Ö –µ–¥–∏–Ω–∏—Ü—ã –∫–æ–¥–∞ –º–æ–≥—É—Ç —Ä–∞–∑–¥–µ–ª—è—Ç—å—Å—è –Ω–∞ —á–∞–Ω–∫–∏. `TextDecoderStream` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏—Ö –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É;
  - –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ `JS-–ø–ª–∞—Ç—Ñ–æ—Ä–º`;
- [–ü–æ—Ç–æ–∫–∏ –¥–ª—è —Å–∂–∞—Ç–∏—è (–≥—Ä—É–ø–ø–æ–≤–æ–π —á–µ—Ä–Ω–æ–≤–∏–∫ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ W3C)](https://wicg.github.io/compression/) - [CompressionStream](https://developer.mozilla.org/en-US/docs/Web/API/CompressionStream) –∏ [DecompressionStream](https://developer.mozilla.org/en-US/docs/Web/API/DecompressionStream):
  - [–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Å–∂–∞—Ç–∏—è](https://wicg.github.io/compression/#supported-formats): `deflate`, `deflate-raw`, `gzip`;
  - –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –º–Ω–æ–≥–∏—Ö `JS-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö`.

#### 6.1.1. –ü—Ä–∏–º–µ—Ä: –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –±–∞–π—Ç–æ–≤ –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ `UTF-8`

```javascript
const response = await fetch("https://example.com");
const readableByteStream = response.body;

const readableStream = readableByteStream
  .pipeThrough(new TextDecoderStream("utf-8"));

for await (const stringChunk of readableStream) {
  console.log(stringChunk);
}
```

`response.body` - —ç—Ç–æ `ReadableByteStream` (–¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫ –±–∞–π—Ç–æ–≤), —á–∞–Ω–∫–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ —è–≤–ª—è—é—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ `Uint8Array`. –ú—ã –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç–æ—Ç –ø–æ—Ç–æ–∫ —á–µ—Ä–µ–∑ `TextDecoderStream` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞, —Å–æ–¥–µ—Ä–∂–∞—â–µ–≥–æ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ —á–∞–Ω–∫–∏.

_–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ_: –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –±–∞–π—Ç–æ–≤–æ–≥–æ —á–∞–Ω–∫–∞ –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –ø–æ–º–æ—â—å—é `TextDecoder`) —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ –±—É–¥–µ—Ç, –ø–æ—Å–∫–æ–ª—å–∫—É –±–∞–π—Ç—ã –µ–¥–∏–Ω–∏—Ü—ã –∫–æ–¥–∞ –º–æ–≥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞–Ω–∫–∞—Ö.

#### 6.1.2. –ü—Ä–∏–º–µ—Ä: —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –¥–ª—è —á—Ç–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—Ö–æ–¥–∞

–°–ª–µ–¥—É—é—â–∏–π –º–æ–¥—É–ª—å `Node.js` –≤—ã–≤–æ–¥–∏—Ç –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª –≤—Å–µ, —á—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—Ö–æ–¥:

```javascript
import { Readable } from "node:stream";

const webStream = Readable.toWeb(process.stdin)
  .pipeThrough(new TextDecoderStream("utf-8"));

for await (const chunk of webStream) {
  console.log(">>>", chunk);
}
```

–î–æ—Å—Ç—É–ø –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É –≤—Ö–æ–¥—É –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ –ø–æ—Ç–æ–∫, —Ö—Ä–∞–Ω—è—â–∏–π—Å—è –≤ `process.stdin`. –ë–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –¥–ª—è –ø–æ—Ç–æ–∫–∞ –∏ –µ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å –ø–æ–º–æ—â—å—é `Readable.toWeb()` —Å–æ–∑–¥–∞–µ—Ç—Å—è –±–∞–π—Ç–æ–≤—ã–π –ø–æ—Ç–æ–∫. –û–Ω –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `TextDecoderStream` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞.

_–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ_: –º—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—Ö–æ–¥ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ - –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ—á–µ—Ä–µ–¥–Ω–æ–π —á–∞–Ω–∫ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º, –æ–Ω –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª. –î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –Ω–∞–º –Ω–µ –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–≤–æ–¥–∞. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –≤ —Å–ª—É—á–∞–µ, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç —Å –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏.

## 7. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö `TS`

–ö–∞—Å—Ç–æ–º–Ω—ã–π `TS` –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—É—Ç–µ–º –ø–µ—Ä–µ–¥–∞—á–∏ –æ–±—ä–µ–∫—Ç–∞ `Transformer` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `TS`. –î–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É:

```javascript
interface Transformer<TInChunk, TOutChunk> {
  start?(
    controller: TransformStreamDefaultController<TOutChunk>
  ): void | Promise<void>;

  transform?(
    chunk: TInChunk,
    controller: TransformStreamDefaultController<TOutChunk>
  ): void | Promise<void>;

  flush?(
    controller: TransformStreamDefaultController<TOutChunk>
  ): void | Promise<void>;
}
```

–°–≤–æ–π—Å—Ç–≤–∞:

- `start(controller)`: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ `TS`. –î–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è–º;
- `transform(chunk, controller)`: –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è. –ü–æ–ª—É—á–∞–µ—Ç –≤—Ö–æ–¥–Ω–æ–π —á–∞–Ω–∫ –∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä `controller` –¥–ª—è –ø–æ–º–µ—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤—ã—Ö–æ–¥–Ω—ã—Ö —á–∞–Ω–∫–æ–≤. –¢–∞–∫–∂–µ –º–æ–∂–µ—Ç –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–µ—â–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å;
- `flush(controller)`: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —á–∞–Ω–∫–æ–≤. –î–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ—á–∏—Å—Ç–∫—É.

–ö–∞–∂–¥—ã–π –∏–∑ —ç—Ç–∏—Ö –º–µ—Ç–æ–¥–æ–≤ –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—Ä–æ–º–∏—Å, –¥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

–ü–∞—Ä–∞–º–µ—Ç—Ä `controller` –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É:

```javascript
interface TransformStreamDefaultController<TOutChunk> {
  enqueue(chunk?: TOutChunk): void;

  readonly desiredSize: number | null;

  terminate(): void;

  error(err?: any): void;
}
```

–°–≤–æ–π—Å—Ç–≤–∞:

- `enqueue(chunk)`: –ø–æ–º–µ—â–∞–µ—Ç —á–∞–Ω–∫ –≤ —Å—Ç–æ—Ä–æ–Ω—É –¥–ª—è —á—Ç–µ–Ω–∏—è (–≤—ã–≤–æ–¥) `TS`;
- `desiredSize`: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∂–µ–ª–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ—á–µ—Ä–µ–¥–∏ —Å—Ç–æ—Ä–æ–Ω—ã –¥–ª—è —á—Ç–µ–Ω–∏—è (–≤—ã–≤–æ–¥–∞) `TS`;
- `terminate()`: –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç–æ—Ä–æ–Ω—É –¥–ª—è —á—Ç–µ–Ω–∏—è (–≤—ã–≤–æ–¥) –∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Å—Ç–æ—Ä–æ–Ω—É –¥–ª—è –∑–∞–ø–∏—Å–∏ (–≤—Ö–æ–¥) `TS` –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏. –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ —Å–ª—É—á–∞–µ, –∫–æ–≥–¥–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω –≤ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —á–∞–Ω–∫–∞—Ö —Å—Ç–æ—Ä–æ–Ω—ã –¥–ª—è –∑–∞–ø–∏—Å–∏ (–≤—Ö–æ–¥–∞) –∏ —Ö–æ—á–µ—Ç –∏—Ö –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å;
- `error(err)`: –ø–µ—Ä–µ–≤–æ–¥–∏—Ç `TS` –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏, –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –Ω–∏–º –±—É–¥—É—Ç –ø—Ä–æ–≤–∞–ª–∏–≤–∞—Ç—å—Å—è —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º `err`.

–ß—Ç–æ –Ω–∞—Å—á–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è? –ü—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –æ—Ç —Å—Ç–æ—Ä–æ–Ω—ã –¥–ª—è —á—Ç–µ–Ω–∏—è (–≤—ã—Ö–æ–¥–∞) –∫ —Å—Ç–æ—Ä–æ–Ω–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ (–≤—Ö–æ–¥). –û–±—ã—á–Ω–æ, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –Ω–µ —Å–∏–ª—å–Ω–æ –≤–ª–∏—è—é—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö. –ü–æ—ç—Ç–æ–º—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, –æ–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ —á–µ—Ä–µ–∑ `transformStreamDefaultController.desiredSize` –∏ –ø–µ—Ä–µ–¥–∞–Ω–æ –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø—Ä–æ–º–∏—Å–∞ –∏–∑ `transformer.transform()`.

### 7.1. –ü—Ä–∏–º–µ—Ä: –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö —á–∞–Ω–∫–æ–≤ –≤ –ø–æ—Ç–æ–∫ —Å—Ç—Ä–æ–∫

–°–ª–µ–¥—É—é—â–∏–π –ø–æ–¥–∫–ª–∞—Å—Å `TS` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –ø–æ—Ç–æ–∫ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö —á–∞–Ω–∫–æ–≤ –≤ –ø–æ—Ç–æ–∫, –≥–¥–µ –∫–∞–∂–¥—ã–π —á–∞–Ω–∫ –∑–∞–Ω–∏–º–∞–µ—Ç —Ä–æ–≤–Ω–æ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É. –ö–∞–∂–¥—ã–π —á–∞–Ω–∫, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ, –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —Å–∏–º–≤–æ–ª–æ–º `\n` –≤ `Unix` –∏ —Å–∏–º–≤–æ–ª–∞–º–∏ `\r\n` –≤ `Windows`:

```javascript
class ChunksToLinesTransformer {
  #previous = "";

  transform(chunk, controller) {
    let startSearch = this.#previous.length;

    this.#previous += chunk;

    while (true) {
      // –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è EOL === "\n" –∏ EOL === "\r\n"
      const eolIndex = this.#previous.indexOf("\n", startSearch);

      if (eolIndex < 0) break;

      // –°—Ç—Ä–æ–∫–∞ –≤–∫–ª—é—á–∞–µ—Ç EOL
      const line = this.#previous.slice(0, eolIndex + 1);

      controller.enqueue(line);

      this.#previous = this.#previous.slice(eolIndex + 1);

      startSearch = 0;
    }
  }

  flush(controller) {
    // –í—ã–ø–æ–ª–Ω—è–µ–º –æ—á–∏—Å—Ç–∫—É –∏ –ø–æ–º–µ—â–∞–µ–º –≤ –æ—á–µ—Ä–µ–¥—å –æ—Å—Ç–∞–≤—à–∏–π—Å—è —Ç–µ–∫—Å—Ç
    if (this.#previous.length > 0) {
      controller.enqueue(this.#previous);
    }
  }
}

class ChunksToLinesStream extends TS {
  constructor() {
    super(new ChunksToLinesTransformer());
  }
}

const stream = new RS({
  async start(controller) {
    controller.enqueue("–Ω–µ—Å–∫–æ–ª—å–∫–æ\n—Å—Ç—Ä–æ–∫\n—Ç–µ–∫—Å—Ç–∞");
    controller.close();
  },
});

const transformStream = new ChunksToLinesStream();

const transformed = stream.pipeThrough(transformStream);

for await (const line of transformed) {
  console.log(">>>", JSON.stringify(line));
}
/**
 * >>> "–Ω–µ—Å–∫–æ–ª—å–∫–æ\n"
 * >>> "—Å—Ç—Ä–æ–∫\n"
 * >>> "—Ç–µ–∫—Å—Ç–∞"
*/
```

_–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ_: `Deno` –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π [TextLineStream](https://doc.deno.land/https://deno.land/std@0.141.0/streams/mod.ts/~/TextLineStream) —Å–æ —Å—Ö–æ–∂–∏–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º.

### 7.2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã —Ç–∞–∫–∂–µ –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –ø–æ—Ç–æ–∫–∞

–ü–æ—Å–∫–æ–ª—å–∫—É `RS` —è–≤–ª—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º—ã–º–∏, –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è –∏—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ –æ—á–µ–Ω—å —ç–ª–µ–≥–∞–Ω—Ç–Ω—ã–º:

```javascript
const stream = new RS({
  async start(controller) {
    controller.enqueue("—Ä–∞–∑");
    controller.enqueue("–¥–≤–∞");
    controller.enqueue("—Ç—Ä–∏");
    controller.close();
  },
});

async function* prefixChunks(prefix, asyncIterable) {
  for await (const chunk of asyncIterable) {
    yield "> " + chunk;
  }
}

const transformedAsyncIterable = prefixChunks("> ", stream);

for await (const transformedChunk of transformedAsyncIterable) {
  console.log(transformedChunk);
}
/**
 * > —Ä–∞–∑
 * > –¥–≤–∞
 * > —Ç—Ä–∏
*/
```

## 8. –î–µ—Ç–∞–ª–∏ –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ç–∞–∫–æ–π –∫–æ–Ω–≤–µ–π–µ—Ä:

```javascript
rs.pipeThrough(ts).pipeTo(ws);
```

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è, —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–µ —ç—Ç–∏–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º (`pipeThrough()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `pipeTo()` –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è `rs` –∫ —Å—Ç–æ—Ä–æ–Ω–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ `ts`):

```javascript
rs -pipeTo-> ts{writable,readable} -pipeTo-> ws
```

–ù–∞–±–ª—é–¥–µ–Ω–∏—è:

- –±–∞–∑–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ `rs` –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–∫ —ç–ª–µ–º–µ–Ω—Ç —Ü–µ–ø–æ—á–∫–∏, –ø—Ä–µ–¥—à–µ—Å—Ç–≤—É—é—â–∏–π `rs`;
- –±–∞–∑–æ–≤—ã–π –ø—Ä–∏–µ–º–Ω–∏–∫ `ws` –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–∫ —ç–ª–µ–º–µ–Ω—Ç —Ü–µ–ø–æ—á–∫–∏, —Å–ª–µ–¥—É—é—â–∏–π –∑–∞ `ws`;
- –∫–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –∏–º–µ–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±—É—Ñ–µ—Ä: –±—É—Ñ–µ—Ä—ã `RS` —Å–ª–µ–¥—É—é—Ç –∑–∞ –±–∞–∑–æ–≤—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏, –±—É—Ñ–µ—Ä—ã `WS` –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø–µ—Ä–µ–¥ –±–∞–∑–æ–≤—ã–º–∏ –ø—Ä–∏–µ–º–Ω–∏–∫–∞–º–∏.

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –±–∞–∑–æ–≤—ã–π –ø—Ä–∏–µ–º–Ω–∏–∫ `ws` —è–≤–ª—è–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω—ã–º, —á—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—é –±—É—Ñ–µ—Ä–∞ `ws`. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–ª–µ–¥—É—é—â–µ–µ:

- `ws` —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏;
- `pipeTo` –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `ts.readable`;
- `ts.readable` —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏;
- `ts` –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–¥–∞—á—É —á–∞–Ω–∫–æ–≤ –∏–∑ `ts.writable` –≤ `ts.readable`;
- `ts.writable` —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏;
- `pipeTo` –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ `rs`;
- `rs` —Å–æ–æ–±—â–∞–µ—Ç –æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ –±–∞–∑–æ–≤–æ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É;
- –±–∞–∑–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –Ω–∞–º —Ç—Ä–µ–±—É–µ—Ç—Å—è 2 –≤–∏–¥–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞:

- —Å—É—â–Ω–æ—Å—Ç–∏, –ø–æ–ª—É—á–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ, –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ—Å—ã–ª–∞—Ç—å —Å–∏–≥–Ω–∞–ª –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è;
- —Å—É—â–Ω–æ—Å—Ç–∏, –æ—Ç–ø—Ä–∞–≤–ª—è—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ, –¥–æ–ª–∂–Ω—ã —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è.

–ü–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –¥–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ –≤–µ–±-–ø–æ—Ç–æ–∫–∞—Ö.

### 8.1. –°–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è

–°–∏–≥–Ω–∞–ª –æ –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–∏ –ø–æ—Å—ã–ª–∞–µ—Ç—Å—è —Å—É—â–Ω–æ—Å—Ç—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ. –í–µ–±-–ø–æ—Ç–æ–∫–∏ –∏–º–µ—é—Ç 2 —Ç–∞–∫–∏—Ö —Å—É—â–Ω–æ—Å—Ç–∏:

- `WS` –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `write` –æ–±—ä–µ–∫—Ç–∞ `Writer`;
- `RS` –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –º–µ—Ç–æ–¥–∞ `enqueue` –æ–±—ä–µ–∫—Ç–∞ `ReadableStreamDefaultController` –±–∞–∑–æ–≤–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞.

–í –æ–±–æ–∏—Ö —Å–ª—É—á–∞—è—Ö –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É—Ñ–µ—Ä–∏–∑—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –æ—á–µ—Ä–µ–¥–µ–π. –°–∏–≥–Ω–∞–ª –æ –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ—á–µ—Ä–µ–¥–∏. –ö–∞–∫ –µ–≥–æ –º–æ–∂–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å?

–í–æ—Ç –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –æ—á–µ—Ä–µ–¥–∏:

- –æ—á–µ—Ä–µ–¥—å `WS` —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `WritableStreamDefaultController`;
- –æ—á–µ—Ä–µ–¥—å `RS` —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `ReadableStreamDefaultController`.

–ñ–µ–ª–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä (desired size) - —ç—Ç–æ —á–∏—Å–ª–æ, –æ–∑–Ω–∞—á–∞—é—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ (–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞, –∫–æ–º–Ω–∞—Ç—ã) (room) –≤ –æ—á–µ—Ä–µ–¥–∏:

- –µ—Å–ª–∏ —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –∏–º–µ–µ—Ç—Å—è, —á–∏—Å–ª–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ;
- –µ—Å–ª–∏ –º–µ—Å—Ç–∞ –Ω–µ—Ç, —á–∏—Å–ª–æ —Ä–∞–≤–Ω–æ `0`;
- –µ—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞, —á–∏—Å–ª–æ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ.

–ü–æ—ç—Ç–æ–º—É –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –∂–µ–ª–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä `<= 0`. –†–∞–∑–º–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ –≥–µ—Ç—Ç–µ—Ä `desiredSize` –æ–±—ä–µ–∫—Ç–∞, —Å–æ–¥–µ—Ä–∂–∞—â–µ–≥–æ –æ—á–µ—Ä–µ–¥—å.

–ö–∞–∫ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∂–µ–ª–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä? –ß–µ—Ä–µ–∑ –æ–±—ä–µ–∫—Ç, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø–æ–º–µ—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å (queuing strategy). `RS` –∏ `WS` –∏–º–µ—é—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–º–µ—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã —á–µ—Ä–µ–∑ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –∏—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å [QueuingStrategy](https://streams.spec.whatwg.org/#dictdef-queuingstrategy) —Å–æ–¥–µ—Ä–∂–∏—Ç 2 —Å–≤–æ–π—Å—Ç–≤–∞:

- –º–µ—Ç–æ–¥ `size(chunk)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑–º–µ—Ä `chunk`;
  - —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ - —ç—Ç–æ —Å—É–º–º–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö—Å—è –≤ –Ω–µ–π —á–∞–Ω–∫–æ–≤;
- —Å–≤–æ–π—Å—Ç–≤–æ `highWaterMark` (–≤–µ—Ä—Ö–Ω—è—è –æ—Ç–º–µ—Ç–∫–∞) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏.

_–ñ–µ–ª–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ - —ç—Ç–æ –≤–µ—Ä—Ö–Ω—è—è –æ—Ç–º–µ—Ç–∫–∞ –º–∏–Ω—É—Å —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏_:

```javascript
desiredSize = highWaterMark - [chunks].reduce((x, y) => x + y, 0);
```

### 8.2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è

–°—É—â–Ω–æ—Å—Ç–∏, –æ—Ç–ø—Ä–∞–≤–ª—è—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ, –¥–æ–ª–∂–Ω—ã —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ.

#### 8.2.1. –ö–æ–¥, –∑–∞–ø–∏—Å—ã–≤–∞—é—â–∏–π –¥–∞–Ω–Ω—ã–µ –≤ `WS` —á–µ—Ä–µ–∑ `Writer`

- –ú—ã –º–æ–∂–µ–º –∂–¥–∞—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–º–∏—Å–∞ –≤ `writer.ready`. –í —ç—Ç–æ –≤—Ä–µ–º—è –º—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã, –∏ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ. –ü—Ä–æ–º–∏—Å —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –æ—á–µ—Ä–µ–¥–∏. –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–µ `writer.desiredSize` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º;
- –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã, –º–æ–∂–Ω–æ –∂–¥–∞—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–º–∏—Å–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ `writer.write()`. –í —ç—Ç–æ –≤—Ä–µ–º—è –æ—á–µ—Ä–µ–¥—å –Ω–µ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è.

–¢–∞–∫–∂–µ –∏–º–µ–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä —á–∞–Ω–∫–æ–≤ –≤ `writer.desiredSize`.

#### 8.2.2. –ë–∞–∑–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ `RS`

–û–±—ä–µ–∫—Ç –±–∞–∑–æ–≤–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è `RS`, –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫. –û–Ω —è–≤–ª—è–µ—Ç—Å—è –∑–≤–µ–Ω–æ–º —Ü–µ–ø–æ—á–∫–∏, —Ä–∞—Å–ø–æ–ª–∞–≥–∞—é—â–∏–º—Å—è –ø–µ—Ä–µ–¥ `RS`.

- –ë–∞–∑–æ–≤—ã–µ pull-–∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –∫–æ–º–Ω–∞—Ç—ã –≤ –æ—á–µ—Ä–µ–¥–∏. –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∫–æ–º–Ω–∞—Ç—ã –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –ø–æ—Å–∫–æ–ª—å–∫—É –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è;
- –±–∞–∑–æ–≤—ã–µ push-–∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å `controller.desiredSize` –ø–æ—Å–ª–µ –ø–æ–º–µ—â–µ–Ω–∏—è —á–µ–≥–æ-–ª–∏–±–æ –≤ –æ—á–µ—Ä–µ–¥—å: –µ—Å–ª–∏ –∂–µ–ª–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä `<=0`, –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ –ø—É—Ç–µ–º –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏—Ö –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.

#### 8.2.3. –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–µ–º–Ω–∏–∫ `WS`

–û–±—ä–µ–∫—Ç –±–∞–∑–æ–≤–æ–≥–æ –ø—Ä–∏–µ–º–Ω–∏–∫–∞, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–π –≤ `WS`, –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–π –ø—Ä–∏–µ–º–Ω–∏–∫. –û–Ω —è–≤–ª—è–µ—Ç—Å—è –∑–≤–µ–Ω–æ–º —Ü–µ–ø–æ—á–∫–∏, —Ä–∞—Å–ø–æ–ª–∞–≥–∞—é—â–∏–º—Å—è –ø–æ—Å–ª–µ `WS`.

–ö–∞–∂–¥—ã–π –≤–Ω–µ—à–Ω–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–æ–æ–±—â–∞–µ—Ç –æ –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–∏ –ø–æ-—Ä–∞–∑–Ω–æ–º—É (–≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö —ç—Ç–æ–≥–æ –≤–æ–æ–±—â–µ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç). –ë–∞–∑–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –º–æ–∂–µ—Ç –æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ –ø—É—Ç–µ–º –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø—Ä–æ–º–∏—Å–∞ –∏–∑ –º–µ—Ç–æ–¥–∞ `write`, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏. –í —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ –≤–µ–±-–ø–æ—Ç–æ–∫–æ–≤ –∏–º–µ–µ—Ç—Å—è [–ø—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç](https://streams.spec.whatwg.org/#example-ws-backpressure).

#### 8.2.4. `TS` (writable-readable)

`TS` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Å—Ç–æ—Ä–æ–Ω—É –¥–ª—è –∑–∞–ø–∏—Å–∏ –∫ —Å—Ç–æ—Ä–æ–Ω–µ –¥–ª—è —á—Ç–µ–Ω–∏—è –ø—É—Ç–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑–æ–≤–æ–≥–æ –ø—Ä–∏–µ–º–Ω–∏–∫–∞ –¥–ª—è –ø–µ—Ä–≤–æ–π –∏ –±–∞–∑–æ–≤–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–ª—è –≤—Ç–æ—Ä–æ–π. –û–Ω –∏–º–µ–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–ª–æ—Ç `[[backpressure]]`, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è.

- –ú–µ—Ç–æ–¥ `write` –±–∞–∑–æ–≤–æ–≥–æ –ø—Ä–∏–µ–º–Ω–∏–∫–∞ —Å—Ç–æ—Ä–æ–Ω—ã –¥–ª—è –∑–∞–ø–∏—Å–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –æ—á–µ—Ä–µ–¥–Ω–æ–≥–æ —á–∞–Ω–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—é `TS` ([TransformStreamDefaultSinkWriteAlgorithm](https://streams.spec.whatwg.org/#transform-stream-default-sink-write-algorithm)). –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å —á–µ—Ä–µ–∑ `TransformStreamDefaultController`. _–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ_: `write()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–µ—Ç–æ–¥–∞. –î–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–≥–æ –ø—Ä–æ–º–∏—Å–∞ `WS` –±—É—Ñ–µ—Ä–∏–∑—É–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –∑–∞–ø–∏—Å—å —Å –ø–æ–º–æ—â—å—é –æ—á–µ—Ä–µ–¥–∏. –ü–æ—ç—Ç–æ–º—É –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω—ã –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å –∏ –µ–µ –∂–µ–ª–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä;
- –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ `TS` –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏ —á–∞–Ω–∫ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å —Å –ø–æ–º–æ—â—å—é `TransformStreamDefaultController` –∏ –æ—á–µ—Ä–µ–¥—å —Å—Ç–æ—Ä–æ–Ω—ã –¥–ª—è —á—Ç–µ–Ω–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–ª–Ω–æ–π ((TransformStreamDefaultControllerEnqueue)[https://streams.spec.whatwg.org/#transform-stream-default-controller-enqueue]);
- –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ `TS` –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ, –µ—Å–ª–∏ —á—Ç–æ-–ª–∏–±–æ —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ `Reader` ((ReadableStreamDefaultReaderRead)[https://streams.spec.whatwg.org/#readable-stream-default-reader-read]);
  - –µ—Å–ª–∏ –≤ –æ—á–µ—Ä–µ–¥–∏ –∏–º–µ—é—Ç—Å—è –∫–æ–º–Ω–∞—Ç—ã, –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –≤—ã–∑–≤–∞—Ç—å `pull()` ((`[[PullSteps]]`)[https://streams.spec.whatwg.org/#rs-default-controller-private-pull]);
  - `pull()` –±–∞–∑–æ–≤–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å—Ç–æ—Ä–æ–Ω—ã –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ–¥–∞–≤–ª–µ–Ω–∏–µ ((TransformStreamDefaultSourcePullAlgorithm)[https://streams.spec.whatwg.org/#transform-stream-default-source-pull]).

#### 8.2.5. `pipeTo()` (RS -> WS)

`pipeTo()` —á–∏—Ç–∞–µ—Ç —á–∞–Ω–∫–∏ –∏–∑ `RS` —á–µ—Ä–µ–∑ `Reader` –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Ö –≤ `WS` —á–µ—Ä–µ–∑ `Writer`. –û–Ω –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ `writer.desiredSize <= 0` (—à–∞–≥ 15 (ReadableStreamPipeTo)[https://streams.spec.whatwg.org/#readable-stream-pipe-to]).

## 9. –ü–æ—Ç–æ–∫–∏ –±–∞–π—Ç–æ–≤

–î–æ —Å–∏—Ö –ø–æ—Ä –º—ã –≥–æ–≤–æ—Ä–∏–ª–∏ –æ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö, –ø–æ—Ç–æ–∫–∞—Ö, —á–∞–Ω–∫–∏ –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å–æ–±–æ–π —Å—Ç—Ä–æ–∫–∏. –ù–æ `Web streams API` —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ—Ç–æ–∫–∏ –±–∞–π—Ç–æ–≤ –¥–ª—è –¥–≤–æ–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –≥–¥–µ —á–∞–Ω–∫–∏ —è–≤–ª—è—é—Ç—Å—è `Uint8Arrays` (—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –º–∞—Å—Å–∏–≤–∞–º–∏):

- `RS` –∏–º–µ—é—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (mode) `bytes`;
- –¥–ª—è `WS` –Ω–µ–≤–∞–∂–Ω–æ, —á–µ–º —è–≤–ª—è—é—Ç—Å—è —á–∞–Ω–∫–∏, —Å—Ç—Ä–æ–∫–∞–º–∏ –∏–ª–∏ `Uint8Arrays`. –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –∫–∞–∫–∏–º –ø–æ—Ç–æ–∫–æ–º —è–≤–ª—è–µ—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä `WS` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ —Å–ø–æ—Å–æ–±–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π –ø—Ä–∏–µ–º–Ω–∏–∫;
- –∫–∞–∫–æ–π –≤–∏–¥ —á–∞–Ω–∫–æ–≤ —Å–ø–æ—Å–æ–±–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å `TS` —Ç–∞–∫–∂–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –µ–≥–æ `Transformer`.

–ü–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫ –±–∞–π—Ç–æ–≤.

### 9.1. –î–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫ –±–∞–π—Ç–æ–≤

–¢–∏–ø —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º `RS` –ø–æ—Ç–æ–∫–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞ `type` –µ–≥–æ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–≤–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `underlyingSource`:

- –µ—Å–ª–∏ `type` –Ω–µ —É–∫–∞–∑–∞–Ω –∏–ª–∏ `underlyingSource` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω, —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ—Ç–æ–∫;
- –µ—Å–ª–∏ `type` –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `"bytes"` (—Å—Ç—Ä–æ–∫–∞), –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –±—É–¥–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å —Å–æ–±–æ–π –ø–æ—Ç–æ–∫ –±–∞–π—Ç–æ–≤:

```javascript
const readableByteStream = new RS({
  type: "bytes",
  async start() {}
  // ...
});
```

–ù–∞ —á—Ç–æ –≤–ª–∏—è–µ—Ç —Ä–µ–∂–∏–º `bytes`?

–í –¥–µ—Ñ–æ–ª—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ –±–∞–∑–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ª—é–±–æ–π –≤–∏–¥ —á–∞–Ω–∫–æ–≤. –í "–±–∞–π—Ç–æ–≤–æ–º" —Ä–µ–∂–∏–º–µ —á–∞–Ω–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `ArrayBufferViews`, —Ç.–µ. `TypedArrays` (—Ç–∞–∫–∏–º–∏ –∫–∞–∫ `Uint8Arrays`) –∏–ª–∏ `DataViews`.

–î–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫ –±–∞–π—Ç–æ–≤ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å 2 –≤–∏–¥–∞ `Reader`:

- `getReader()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä `ReadableStreamDefaultReader`;
- `getReader({ mode: "byob" })` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä `ReadableStreamBYOBReader`.

`BYOB` —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `Bring Your Own Buffer` (–ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –±—É—Ñ–µ—Ä) –∏ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º—ã –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å –±—É—Ñ–µ—Ä (`ArrayBufferView`) –≤ `reader.read()`. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –¥–∞–Ω–Ω—ã–π `ArrayBufferView` –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –∏ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è. –û–¥–Ω–∞–∫–æ `read()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –≤–∏–¥–µ –Ω–æ–≤–æ–≥–æ `ArrayBufferView`, –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç —Ç–æ—Ç –∂–µ —Ç–∏–ø –∏ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ —Ç–æ–π –∂–µ –æ–±–ª–∞—Å—Ç–∏ —Ç–æ–≥–æ –∂–µ —Å–∞–º–æ–≥–æ `ArrayBuffer`.

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∏ –±–∞–π—Ç–æ–≤ –∏–º–µ—é—Ç —Ä–∞–∑–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã: –æ–Ω–∏ —è–≤–ª—è—é—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ `ReadableByteStreamController` (–∞ –Ω–µ `ReadableStreamDefaultController`). –ü–æ–º–∏–º–æ –ø—Ä–∏–Ω—É–∂–¥–µ–Ω–∏—è (forcing) –±–∞–∑–æ–≤—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø–æ–º–µ—â–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å `ArrayBufferViews` (`TypedArrays` –∏–ª–∏ `DataViews`), –æ–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç `ReadableStreamBYOBReaders` —á–µ—Ä–µ–∑ —Å–≤–æ–π—Å—Ç–≤–æ [byobRequest](https://streams.spec.whatwg.org/#rbs-controller-prototype). –í —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ –≤–µ–±-–ø–æ—Ç–æ–∫–æ–≤ –ø—Ä–∏–≤–µ–¥–µ–Ω–æ [2 –ø—Ä–∏–º–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `byobRequest`](https://streams.spec.whatwg.org/#creating-examples).

### 9.2. –ü—Ä–∏–º–µ—Ä: –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫ –±–∞–π—Ç–æ–≤, –∑–∞–ø–æ–ª–Ω—è–µ–º—ã–π –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

–í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫ –±–∞–π—Ç–æ–≤, –∑–∞–ø–æ–ª–Ω—è—é—â–∏–π —á–∞–Ω–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

```javascript
import { promisify } from "node:util";
import { randomFill } from "node:crypto";

const asyncRandomFill = promisify(randomFill);

const readableByteStream = new RS({
  type: "bytes",

  async pull(controller) {
    const byobRequest = controller.byobRequest;

    await asyncRandomFill(byobRequest.view);

    byobRequest.respond(byobRequest.view.byteLength);
  },
});

const reader = readableByteStream.getReader({ mode: "byob" });

const buffer = new Uint8Array(10); // (1)

const firstChunk = await reader.read(buffer); // (2)
console.log(firstChunk);
```

–ü–æ—Å–∫–æ–ª—å–∫—É `readableByteStream` —è–≤–ª—è–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º, –º—ã –Ω–µ –º–æ–∂–µ–º –ø–µ—Ä–µ–±—Ä–∞—Ç—å –µ–≥–æ –≤ —Ü–∏–∫–ª–µ. –ü–æ—ç—Ç–æ–º—É —á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ–≥–æ –ø–µ—Ä–≤—ã–π —á–∞–Ω–∫ (2).

–°–æ–∑–¥–∞–Ω–Ω—ã–π –±—É—Ñ–µ—Ä (1) –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `reader.read()` (2) –∏ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è —á—Ç–µ–Ω–∏—è.

### 9.3. –ü—Ä–∏–º–µ—Ä: —Å–∂–∞—Ç–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞ –±–∞–π—Ç–æ–≤

–í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫ –±–∞–π—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–æ—Ç–æ–∫, —Å–∂–∏–º–∞—é—â–∏–π –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç `GZIP`:

```javascript
const readableByteStream = new RS({
  type: "bytes",

  start(controller) {
    // 256 –Ω—É–ª–µ–π
    controller.enqueue(new Uint8Array(256));
    controller.close();
  },
});

const transformedStream = readableByteStream.pipeThrough(
  new CompressionStream("gzip"));

await logChunks(transformedStream);

async function logChunks(readableByteStream) {
  const reader = transformedStream.getReader();

  try {
    while (true) {
      const { done, value } = await reader.read();

      if (done) break;

      console.log(value);
    }
  } finally {
    reader.releaseLock();
  }
}
```

### 9.4. –ü—Ä–∏–º–µ—Ä: —á—Ç–µ–Ω–∏–µ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –ø–æ–º–æ—â—å—é `fetch()`

–†–µ–∑—É–ª—å—Ç–∞—Ç `fetch()` —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç–æ–º –æ—Ç–≤–µ—Ç–∞, —Å–≤–æ–π—Å—Ç–≤–æ `body` –∫–æ—Ç–æ—Ä–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫ –±–∞–π—Ç–æ–≤. –î–∞–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ—Ç–æ–∫ —Å –ø–æ–º–æ—â—å—é `TextDecoderStream`:

```javascript
const response = await fetch("https://example.com");
const readableByteStream = response.body;

const readableStream = readableByteStream.pipeThrough(
  new TextDecoderStream("utf-8"));

for await (const stringChunk of readableStream) {
  console.log(stringChunk);
}
```

## 10. –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è `Node.js` –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

`Node.js` - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è —Å–ª–µ–¥—É—é—â–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∏–º–µ–Ω—É–µ–º—ã–µ [utility consumers](https://nodejs.org/api/webstreams.html#utility-consumers) (—É—Ç–∏–ª–∏—Ç–∞–º–∏ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è?):

```javascript
import {
  arrayBuffer,
  blob,
  buffer,
  json,
  text,
} from "node:stream/consumers";
```

–≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç –≤–µ–± `RS`, `Readables` `Node.js` –∏ `AsyncIterators` –≤ –ø—Ä–æ–º–∏—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è:

- `ArrayBuffers` - `arrayBuffer()`;
- `Blobs` - `blob()`;
- –±—É—Ñ–µ—Ä–∞–º–∏ `Node.js` - `buffer()`;
- –æ–±—ä–µ–∫—Ç–∞–º–∏ `JSON` - `json()`;
- —Å—Ç—Ä–æ–∫–∞–º–∏ - `text()`.

–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–º–µ—é—Ç –∫–æ–¥–∏—Ä–æ–≤–∫—É `UTF-8`:

```javascript
import * as streamConsumers from "node:stream/consumers";

const readableByteStream = new RS({
  type: "bytes",

  start(controller) {
    // TextEncoder –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å—Ç—Ä–æ–∫–∏ –≤  Uint8Arrays –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ UTF-8
    const encoder = new TextEncoder();

    const view = encoder.encode(`"üòÄ"`);

    assert.deepEqual(
      view,
      Uint8Array.of(34, 240, 159, 152, 128, 34)
    );

    controller.enqueue(view);

    controller.close();
  },
});

const jsonData = await streamConsumers.json(readableByteStream);

assert.equal(jsonData, "üòÄ");
```

–°—Ç—Ä–æ–∫–æ–≤—ã–µ –ø–æ—Ç–æ–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç, –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è:

```javascript
import * as streamConsumers from "node:stream/consumers";

const readableByteStream = new RS({
  start(controller) {
    controller.enqueue(`"üòÄ"`);

    controller.close();
  },
});

const jsonData = await streamConsumers.json(readableByteStream);

assert.equal(jsonData, "üòÄ");
```

–ú—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–ª–∏ –¥–∞–ª–µ–∫–æ –Ω–µ –≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã `API` –≤–µ–±-–ø–æ—Ç–æ–∫–æ–≤. –í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ [—Å—Å—ã–ª–æ–∫ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏–∑—É—á–µ–Ω–∏—è —ç—Ç–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞](https://2ality.com/2022/06/web-streams-nodejs.html#further-reading).